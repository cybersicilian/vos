var R$=Object.create;var{defineProperty:R1,getPrototypeOf:L$,getOwnPropertyNames:U$}=Object;var D$=Object.prototype.hasOwnProperty;var L0=($,J,K)=>{K=$!=null?R$(L$($)):{};const X=J||!$||!$.__esModule?R1(K,"default",{value:$,enumerable:!0}):K;for(let Q of U$($))if(!D$.call(X,Q))R1(X,Q,{get:()=>$[Q],enumerable:!0});return X};var A=($,J)=>()=>(J||$((J={exports:{}}).exports,J),J.exports);var W=($)=>{return import.meta.require($)};var B1=A((X7,D1)=>{var L1=function($){$.emit("close")},x$=function(){if(!this.destroyed&&this._writableState.finished)this.destroy()},U1=function($){if(this.removeListener("error",U1),this.destroy(),this.listenerCount("error")===0)this.emit("error",$)},q$=function($,J){let K=!0;const X=new W$({...J,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return $.on("message",function Q(Z,Y){const _=!Y&&X._readableState.objectMode?Z.toString():Z;if(!X.push(_))$.pause()}),$.once("error",function Q(Z){if(X.destroyed)return;K=!1,X.destroy(Z)}),$.once("close",function Q(){if(X.destroyed)return;X.push(null)}),X._destroy=function(Q,Z){if($.readyState===$.CLOSED){Z(Q),process.nextTick(L1,X);return}let Y=!1;if($.once("error",function _(j){Y=!0,Z(j)}),$.once("close",function _(){if(!Y)Z(Q);process.nextTick(L1,X)}),K)$.terminate()},X._final=function(Q){if($.readyState===$.CONNECTING){$.once("open",function Z(){X._final(Q)});return}if($._socket===null)return;if($._socket._writableState.finished){if(Q(),X._readableState.endEmitted)X.destroy()}else $._socket.once("finish",function Z(){Q()}),$.close()},X._read=function(){if($.isPaused)$.resume()},X._write=function(Q,Z,Y){if($.readyState===$.CONNECTING){$.once("open",function _(){X._write(Q,Z,Y)});return}$.send(Q,Y)},X.on("end",x$),X.on("error",U1),X},{Duplex:W$}=W("stream");D1.exports=q$});var J0=A((Q7,I1)=>{I1.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var S0=A((Z7,l0)=>{var S$=function($,J){if($.length===0)return P$;if($.length===1)return $[0];const K=Buffer.allocUnsafe(J);let X=0;for(let Q=0;Q<$.length;Q++){const Z=$[Q];K.set(Z,X),X+=Z.length}if(X<J)return new X1(K.buffer,K.byteOffset,X);return K},W1=function($,J,K,X,Q){for(let Z=0;Z<Q;Z++)K[X+Z]=$[Z]^J[Z&3]},x1=function($,J){for(let K=0;K<$.length;K++)$[K]^=J[K&3]},E$=function($){if($.length===$.buffer.byteLength)return $.buffer;return $.buffer.slice($.byteOffset,$.byteOffset+$.length)},Q1=function($){if(Q1.readOnly=!0,Buffer.isBuffer($))return $;let J;if($ instanceof ArrayBuffer)J=new X1($);else if(ArrayBuffer.isView($))J=new X1($.buffer,$.byteOffset,$.byteLength);else J=Buffer.from($),Q1.readOnly=!1;return J},{EMPTY_BUFFER:P$}=J0(),X1=Buffer[Symbol.species];l0.exports={concat:S$,mask:W1,toArrayBuffer:E$,toBuffer:Q1,unmask:x1};if(!process.env.WS_NO_BUFFER_UTIL)try{const $=(()=>{ throw new Error(`Cannot require module "bufferutil"`);})();l0.exports.mask=function(J,K,X,Q,Z){if(Z<48)W1(J,K,X,Q,Z);else $.mask(J,K,X,Q,Z)},l0.exports.unmask=function(J,K){if(J.length<32)x1(J,K);else $.unmask(J,K)}}catch($){}});var E1=A((j7,S1)=>{var q1=Symbol("kDone"),Z1=Symbol("kRun");class P1{constructor($){this[q1]=()=>{this.pending--,this[Z1]()},this.concurrency=$||Infinity,this.jobs=[],this.pending=0}add($){this.jobs.push($),this[Z1]()}[Z1](){if(this.pending===this.concurrency)return;if(this.jobs.length){const $=this.jobs.shift();this.pending++,$(this[q1])}}}S1.exports=P1});var w0=A((G7,C1)=>{var f$=function($){this[K0].push($),this[a]+=$.length},f1=function($){if(this[a]+=$.length,this[o0]._maxPayload<1||this[a]<=this[o0]._maxPayload){this[K0].push($);return}this[c0]=new RangeError("Max payload size exceeded"),this[c0].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[c0][w1]=1009,this.removeListener("data",f1),this.reset()},C$=function($){this[o0]._inflate=null,$[w1]=1007,this[h0]($)},E0=W("zlib"),h1=S0(),h$=E1(),{kStatusCode:w1}=J0(),w$=Buffer[Symbol.species],v$=Buffer.from([0,0,255,255]),o0=Symbol("permessage-deflate"),a=Symbol("total-length"),h0=Symbol("callback"),K0=Symbol("buffers"),c0=Symbol("error"),d0;class v1{constructor($,J,K){if(this._maxPayload=K|0,this._options=$||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!J,this._deflate=null,this._inflate=null,this.params=null,!d0){const X=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;d0=new h$(X)}}static get extensionName(){return"permessage-deflate"}offer(){const $={};if(this._options.serverNoContextTakeover)$.server_no_context_takeover=!0;if(this._options.clientNoContextTakeover)$.client_no_context_takeover=!0;if(this._options.serverMaxWindowBits)$.server_max_window_bits=this._options.serverMaxWindowBits;if(this._options.clientMaxWindowBits)$.client_max_window_bits=this._options.clientMaxWindowBits;else if(this._options.clientMaxWindowBits==null)$.client_max_window_bits=!0;return $}accept($){return $=this.normalizeParams($),this.params=this._isServer?this.acceptAsServer($):this.acceptAsClient($),this.params}cleanup(){if(this._inflate)this._inflate.close(),this._inflate=null;if(this._deflate){const $=this._deflate[h0];if(this._deflate.close(),this._deflate=null,$)$(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer($){const J=this._options,K=$.find((X)=>{if(J.serverNoContextTakeover===!1&&X.server_no_context_takeover||X.server_max_window_bits&&(J.serverMaxWindowBits===!1||typeof J.serverMaxWindowBits==="number"&&J.serverMaxWindowBits>X.server_max_window_bits)||typeof J.clientMaxWindowBits==="number"&&!X.client_max_window_bits)return!1;return!0});if(!K)throw new Error("None of the extension offers can be accepted");if(J.serverNoContextTakeover)K.server_no_context_takeover=!0;if(J.clientNoContextTakeover)K.client_no_context_takeover=!0;if(typeof J.serverMaxWindowBits==="number")K.server_max_window_bits=J.serverMaxWindowBits;if(typeof J.clientMaxWindowBits==="number")K.client_max_window_bits=J.clientMaxWindowBits;else if(K.client_max_window_bits===!0||J.clientMaxWindowBits===!1)delete K.client_max_window_bits;return K}acceptAsClient($){const J=$[0];if(this._options.clientNoContextTakeover===!1&&J.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!J.client_max_window_bits){if(typeof this._options.clientMaxWindowBits==="number")J.client_max_window_bits=this._options.clientMaxWindowBits}else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits==="number"&&J.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return J}normalizeParams($){return $.forEach((J)=>{Object.keys(J).forEach((K)=>{let X=J[K];if(X.length>1)throw new Error(`Parameter "${K}" must have only a single value`);if(X=X[0],K==="client_max_window_bits"){if(X!==!0){const Q=+X;if(!Number.isInteger(Q)||Q<8||Q>15)throw new TypeError(`Invalid value for parameter "${K}": ${X}`);X=Q}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${K}": ${X}`)}else if(K==="server_max_window_bits"){const Q=+X;if(!Number.isInteger(Q)||Q<8||Q>15)throw new TypeError(`Invalid value for parameter "${K}": ${X}`);X=Q}else if(K==="client_no_context_takeover"||K==="server_no_context_takeover"){if(X!==!0)throw new TypeError(`Invalid value for parameter "${K}": ${X}`)}else throw new Error(`Unknown parameter "${K}"`);J[K]=X})}),$}decompress($,J,K){d0.add((X)=>{this._decompress($,J,(Q,Z)=>{X(),K(Q,Z)})})}compress($,J,K){d0.add((X)=>{this._compress($,J,(Q,Z)=>{X(),K(Q,Z)})})}_decompress($,J,K){const X=this._isServer?"client":"server";if(!this._inflate){const Q=`${X}_max_window_bits`,Z=typeof this.params[Q]!=="number"?E0.Z_DEFAULT_WINDOWBITS:this.params[Q];this._inflate=E0.createInflateRaw({...this._options.zlibInflateOptions,windowBits:Z}),this._inflate[o0]=this,this._inflate[a]=0,this._inflate[K0]=[],this._inflate.on("error",C$),this._inflate.on("data",f1)}if(this._inflate[h0]=K,this._inflate.write($),J)this._inflate.write(v$);this._inflate.flush(()=>{const Q=this._inflate[c0];if(Q){this._inflate.close(),this._inflate=null,K(Q);return}const Z=h1.concat(this._inflate[K0],this._inflate[a]);if(this._inflate._readableState.endEmitted)this._inflate.close(),this._inflate=null;else if(this._inflate[a]=0,this._inflate[K0]=[],J&&this.params[`${X}_no_context_takeover`])this._inflate.reset();K(null,Z)})}_compress($,J,K){const X=this._isServer?"server":"client";if(!this._deflate){const Q=`${X}_max_window_bits`,Z=typeof this.params[Q]!=="number"?E0.Z_DEFAULT_WINDOWBITS:this.params[Q];this._deflate=E0.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:Z}),this._deflate[a]=0,this._deflate[K0]=[],this._deflate.on("data",f$)}this._deflate[h0]=K,this._deflate.write($),this._deflate.flush(E0.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let Q=h1.concat(this._deflate[K0],this._deflate[a]);if(J)Q=new w$(Q.buffer,Q.byteOffset,Q.length-4);if(this._deflate[h0]=null,this._deflate[a]=0,this._deflate[K0]=[],J&&this.params[`${X}_no_context_takeover`])this._deflate.reset();K(null,Q)})}}C1.exports=v1});var v0=A((V7,i0)=>{var m$=function($){return $>=1000&&$<=1014&&$!==1004&&$!==1005&&$!==1006||$>=3000&&$<=4999},j1=function($){const J=$.length;let K=0;while(K<J)if(($[K]&128)===0)K++;else if(($[K]&224)===192){if(K+1===J||($[K+1]&192)!==128||($[K]&254)===192)return!1;K+=2}else if(($[K]&240)===224){if(K+2>=J||($[K+1]&192)!==128||($[K+2]&192)!==128||$[K]===224&&($[K+1]&224)===128||$[K]===237&&($[K+1]&224)===160)return!1;K+=3}else if(($[K]&248)===240){if(K+3>=J||($[K+1]&192)!==128||($[K+2]&192)!==128||($[K+3]&192)!==128||$[K]===240&&($[K+1]&240)===128||$[K]===244&&$[K+1]>143||$[K]>244)return!1;K+=4}else return!1;return!0},{isUtf8:u1}=W("buffer"),u$=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];i0.exports={isValidStatusCode:m$,isValidUTF8:j1,tokenChars:u$};if(u1)i0.exports.isValidUTF8=function($){return $.length<24?j1($):u1($)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{const $=(()=>{ throw new Error(`Cannot require module "utf-8-validate"`);})();i0.exports.isValidUTF8=function(J){return J.length<32?j1(J):$(J)}}catch($){}});var V1=A((Y7,y1)=>{var x=function($,J,K,X,Q){const Z=new $(K?`Invalid WebSocket frame: ${J}`:J);return Error.captureStackTrace(Z,x),Z.code=Q,Z[A$]=X,Z},c$=function($){l$.then($).catch(i$)},o$=function($){throw $},i$=function($){process.nextTick(o$,$)},{Writable:k$}=W("stream"),m1=w0(),{BINARY_TYPES:p$,EMPTY_BUFFER:k1,kStatusCode:A$,kWebSocket:y$}=J0(),{concat:G1,toArrayBuffer:n$,unmask:g$}=S0(),{isValidStatusCode:b$,isValidUTF8:p1}=v0(),t0=Buffer[Symbol.species],l$=Promise.resolve(),d$=typeof queueMicrotask==="function"?queueMicrotask:c$;class A1 extends k${constructor($={}){super();this._binaryType=$.binaryType||p$[0],this._extensions=$.extensions||{},this._isServer=!!$.isServer,this._maxPayload=$.maxPayload|0,this._skipUTF8Validation=!!$.skipUTF8Validation,this[y$]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=0,this._loop=!1}_write($,J,K){if(this._opcode===8&&this._state==0)return K();this._bufferedBytes+=$.length,this._buffers.push($),this.startLoop(K)}consume($){if(this._bufferedBytes-=$,$===this._buffers[0].length)return this._buffers.shift();if($<this._buffers[0].length){const K=this._buffers[0];return this._buffers[0]=new t0(K.buffer,K.byteOffset+$,K.length-$),new t0(K.buffer,K.byteOffset,$)}const J=Buffer.allocUnsafe($);do{const K=this._buffers[0],X=J.length-$;if($>=K.length)J.set(this._buffers.shift(),X);else J.set(new Uint8Array(K.buffer,K.byteOffset,$),X),this._buffers[0]=new t0(K.buffer,K.byteOffset+$,K.length-$);$-=K.length}while($>0);return J}startLoop($){let J;this._loop=!0;do switch(this._state){case 0:J=this.getInfo();break;case 1:J=this.getPayloadLength16();break;case 2:J=this.getPayloadLength64();break;case 3:this.getMask();break;case 4:J=this.getData($);break;case 5:this._loop=!1;return;default:this._loop=!1,d$(()=>{this._state=0,this.startLoop($)});return}while(this._loop);$(J)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}const $=this.consume(2);if(($[0]&48)!==0)return this._loop=!1,x(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");const J=($[0]&64)===64;if(J&&!this._extensions[m1.extensionName])return this._loop=!1,x(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=($[0]&128)===128,this._opcode=$[0]&15,this._payloadLength=$[1]&127,this._opcode===0){if(J)return this._loop=!1,x(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,x(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,x(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=J}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,x(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(J)return this._loop=!1,x(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1)return this._loop=!1,x(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}else return this._loop=!1,x(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin&&!this._fragmented)this._fragmented=this._opcode;if(this._masked=($[1]&128)===128,this._isServer){if(!this._masked)return this._loop=!1,x(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,x(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(this._payloadLength===126)this._state=1;else if(this._payloadLength===127)this._state=2;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}const $=this.consume(8),J=$.readUInt32BE(0);if(J>Math.pow(2,21)-1)return this._loop=!1,x(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");return this._payloadLength=J*Math.pow(2,32)+$.readUInt32BE(4),this.haveLength()}haveLength(){if(this._payloadLength&&this._opcode<8){if(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)return this._loop=!1,x(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH")}if(this._masked)this._state=3;else this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData($){let J=k1;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}if(J=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!==0)g$(J,this._mask)}if(this._opcode>7)return this.controlMessage(J);if(this._compressed){this._state=5,this.decompress(J,$);return}if(J.length)this._messageLength=this._totalPayloadLength,this._fragments.push(J);return this.dataMessage()}decompress($,J){this._extensions[m1.extensionName].decompress($,this._fin,(X,Q)=>{if(X)return J(X);if(Q.length){if(this._messageLength+=Q.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return J(x(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(Q)}const Z=this.dataMessage();if(Z)return J(Z);this.startLoop(J)})}dataMessage(){if(this._fin){const $=this._messageLength,J=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let K;if(this._binaryType==="nodebuffer")K=G1(J,$);else if(this._binaryType==="arraybuffer")K=n$(G1(J,$));else K=J;this.emit("message",K,!0)}else{const K=G1(J,$);if(!this._skipUTF8Validation&&!p1(K))return this._loop=!1,x(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",K,!1)}}this._state=6}controlMessage($){if(this._opcode===8)if(this._loop=!1,$.length===0)this.emit("conclude",1005,k1),this.end(),this._state=0;else{const J=$.readUInt16BE(0);if(!b$(J))return x(RangeError,`invalid status code ${J}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");const K=new t0($.buffer,$.byteOffset+2,$.length-2);if(!this._skipUTF8Validation&&!p1(K))return x(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",J,K),this.end(),this._state=0}else if(this._opcode===9)this.emit("ping",$),this._state=6;else this.emit("pong",$),this._state=6}}y1.exports=A1});var Y1=A((_7,b1)=>{var{Duplex:z7}=W("stream"),{randomFillSync:t$}=W("crypto"),n1=w0(),{EMPTY_BUFFER:s$}=J0(),{isValidStatusCode:a$}=v0(),{mask:g1,toBuffer:T0}=S0(),l=Symbol("kByteLength"),r$=Buffer.alloc(4);class X0{constructor($,J,K){if(this._extensions=J||{},K)this._generateMask=K,this._maskBuffer=Buffer.alloc(4);this._socket=$,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame($,J){let K,X=!1,Q=2,Z=!1;if(J.mask){if(K=J.maskBuffer||r$,J.generateMask)J.generateMask(K);else t$(K,0,4);Z=(K[0]|K[1]|K[2]|K[3])===0,Q=6}let Y;if(typeof $==="string")if((!J.mask||Z)&&J[l]!==void 0)Y=J[l];else $=Buffer.from($),Y=$.length;else Y=$.length,X=J.mask&&J.readOnly&&!Z;let _=Y;if(Y>=65536)Q+=8,_=127;else if(Y>125)Q+=2,_=126;const j=Buffer.allocUnsafe(X?Y+Q:Q);if(j[0]=J.fin?J.opcode|128:J.opcode,J.rsv1)j[0]|=64;if(j[1]=_,_===126)j.writeUInt16BE(Y,2);else if(_===127)j[2]=j[3]=0,j.writeUIntBE(Y,4,6);if(!J.mask)return[j,$];if(j[1]|=128,j[Q-4]=K[0],j[Q-3]=K[1],j[Q-2]=K[2],j[Q-1]=K[3],Z)return[j,$];if(X)return g1($,K,j,Q,Y),[j];return g1($,K,$,0,Y),[j,$]}close($,J,K,X){let Q;if($===void 0)Q=s$;else if(typeof $!=="number"||!a$($))throw new TypeError("First argument must be a valid error code number");else if(J===void 0||!J.length)Q=Buffer.allocUnsafe(2),Q.writeUInt16BE($,0);else{const Y=Buffer.byteLength(J);if(Y>123)throw new RangeError("The message must not be greater than 123 bytes");if(Q=Buffer.allocUnsafe(2+Y),Q.writeUInt16BE($,0),typeof J==="string")Q.write(J,2);else Q.set(J,2)}const Z={[l]:Q.length,fin:!0,generateMask:this._generateMask,mask:K,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};if(this._deflating)this.enqueue([this.dispatch,Q,!1,Z,X]);else this.sendFrame(X0.frame(Q,Z),X)}ping($,J,K){let X,Q;if(typeof $==="string")X=Buffer.byteLength($),Q=!1;else $=T0($),X=$.length,Q=T0.readOnly;if(X>125)throw new RangeError("The data size must not be greater than 125 bytes");const Z={[l]:X,fin:!0,generateMask:this._generateMask,mask:J,maskBuffer:this._maskBuffer,opcode:9,readOnly:Q,rsv1:!1};if(this._deflating)this.enqueue([this.dispatch,$,!1,Z,K]);else this.sendFrame(X0.frame($,Z),K)}pong($,J,K){let X,Q;if(typeof $==="string")X=Buffer.byteLength($),Q=!1;else $=T0($),X=$.length,Q=T0.readOnly;if(X>125)throw new RangeError("The data size must not be greater than 125 bytes");const Z={[l]:X,fin:!0,generateMask:this._generateMask,mask:J,maskBuffer:this._maskBuffer,opcode:10,readOnly:Q,rsv1:!1};if(this._deflating)this.enqueue([this.dispatch,$,!1,Z,K]);else this.sendFrame(X0.frame($,Z),K)}send($,J,K){const X=this._extensions[n1.extensionName];let Q=J.binary?2:1,Z=J.compress,Y,_;if(typeof $==="string")Y=Buffer.byteLength($),_=!1;else $=T0($),Y=$.length,_=T0.readOnly;if(this._firstFragment){if(this._firstFragment=!1,Z&&X&&X.params[X._isServer?"server_no_context_takeover":"client_no_context_takeover"])Z=Y>=X._threshold;this._compress=Z}else Z=!1,Q=0;if(J.fin)this._firstFragment=!0;if(X){const j={[l]:Y,fin:J.fin,generateMask:this._generateMask,mask:J.mask,maskBuffer:this._maskBuffer,opcode:Q,readOnly:_,rsv1:Z};if(this._deflating)this.enqueue([this.dispatch,$,this._compress,j,K]);else this.dispatch($,this._compress,j,K)}else this.sendFrame(X0.frame($,{[l]:Y,fin:J.fin,generateMask:this._generateMask,mask:J.mask,maskBuffer:this._maskBuffer,opcode:Q,readOnly:_,rsv1:!1}),K)}dispatch($,J,K,X){if(!J){this.sendFrame(X0.frame($,K),X);return}const Q=this._extensions[n1.extensionName];this._bufferedBytes+=K[l],this._deflating=!0,Q.compress($,K.fin,(Z,Y)=>{if(this._socket.destroyed){const _=new Error("The socket was closed while data was being compressed");if(typeof X==="function")X(_);for(let j=0;j<this._queue.length;j++){const F=this._queue[j],N=F[F.length-1];if(typeof N==="function")N(_)}return}this._bufferedBytes-=K[l],this._deflating=!1,K.readOnly=!1,this.sendFrame(X0.frame(Y,K),X),this.dequeue()})}dequeue(){while(!this._deflating&&this._queue.length){const $=this._queue.shift();this._bufferedBytes-=$[3][l],Reflect.apply($[0],this,$.slice(1))}}enqueue($){this._bufferedBytes+=$[3][l],this._queue.push($)}sendFrame($,J){if($.length===2)this._socket.cork(),this._socket.write($[0]),this._socket.write($[1],J),this._socket.uncork();else this._socket.write($[0],J)}}b1.exports=X0});var r1=A((H7,a1)=>{var s0=function($,J,K){if(typeof $==="object"&&$.handleEvent)$.handleEvent.call($,K);else $.call(J,K)},{kForOnEventAttribute:f0,kListener:z1}=J0(),l1=Symbol("kCode"),d1=Symbol("kData"),c1=Symbol("kError"),o1=Symbol("kMessage"),i1=Symbol("kReason"),O0=Symbol("kTarget"),t1=Symbol("kType"),s1=Symbol("kWasClean");class Q0{constructor($){this[O0]=null,this[t1]=$}get target(){return this[O0]}get type(){return this[t1]}}Object.defineProperty(Q0.prototype,"target",{enumerable:!0});Object.defineProperty(Q0.prototype,"type",{enumerable:!0});class M0 extends Q0{constructor($,J={}){super($);this[l1]=J.code===void 0?0:J.code,this[i1]=J.reason===void 0?"":J.reason,this[s1]=J.wasClean===void 0?!1:J.wasClean}get code(){return this[l1]}get reason(){return this[i1]}get wasClean(){return this[s1]}}Object.defineProperty(M0.prototype,"code",{enumerable:!0});Object.defineProperty(M0.prototype,"reason",{enumerable:!0});Object.defineProperty(M0.prototype,"wasClean",{enumerable:!0});class C0 extends Q0{constructor($,J={}){super($);this[c1]=J.error===void 0?null:J.error,this[o1]=J.message===void 0?"":J.message}get error(){return this[c1]}get message(){return this[o1]}}Object.defineProperty(C0.prototype,"error",{enumerable:!0});Object.defineProperty(C0.prototype,"message",{enumerable:!0});class a0 extends Q0{constructor($,J={}){super($);this[d1]=J.data===void 0?null:J.data}get data(){return this[d1]}}Object.defineProperty(a0.prototype,"data",{enumerable:!0});var e$={addEventListener($,J,K={}){for(let Q of this.listeners($))if(!K[f0]&&Q[z1]===J&&!Q[f0])return;let X;if($==="message")X=function Q(Z,Y){const _=new a0("message",{data:Y?Z:Z.toString()});_[O0]=this,s0(J,this,_)};else if($==="close")X=function Q(Z,Y){const _=new M0("close",{code:Z,reason:Y.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});_[O0]=this,s0(J,this,_)};else if($==="error")X=function Q(Z){const Y=new C0("error",{error:Z,message:Z.message});Y[O0]=this,s0(J,this,Y)};else if($==="open")X=function Q(){const Z=new Q0("open");Z[O0]=this,s0(J,this,Z)};else return;if(X[f0]=!!K[f0],X[z1]=J,K.once)this.once($,X);else this.on($,X)},removeEventListener($,J){for(let K of this.listeners($))if(K[z1]===J&&!K[f0]){this.removeListener($,K);break}}};a1.exports={CloseEvent:M0,ErrorEvent:C0,Event:Q0,EventTarget:e$,MessageEvent:a0}});var _1=A((N7,e1)=>{var o=function($,J,K){if($[J]===void 0)$[J]=[K];else $[J].push(K)},$5=function($){const J=Object.create(null);let K=Object.create(null),X=!1,Q=!1,Z=!1,Y,_,j=-1,F=-1,N=-1,O=0;for(;O<$.length;O++)if(F=$.charCodeAt(O),Y===void 0)if(N===-1&&u0[F]===1){if(j===-1)j=O}else if(O!==0&&(F===32||F===9)){if(N===-1&&j!==-1)N=O}else if(F===59||F===44){if(j===-1)throw new SyntaxError(`Unexpected character at index ${O}`);if(N===-1)N=O;const I=$.slice(j,N);if(F===44)o(J,I,K),K=Object.create(null);else Y=I;j=N=-1}else throw new SyntaxError(`Unexpected character at index ${O}`);else if(_===void 0)if(N===-1&&u0[F]===1){if(j===-1)j=O}else if(F===32||F===9){if(N===-1&&j!==-1)N=O}else if(F===59||F===44){if(j===-1)throw new SyntaxError(`Unexpected character at index ${O}`);if(N===-1)N=O;if(o(K,$.slice(j,N),!0),F===44)o(J,Y,K),K=Object.create(null),Y=void 0;j=N=-1}else if(F===61&&j!==-1&&N===-1)_=$.slice(j,O),j=N=-1;else throw new SyntaxError(`Unexpected character at index ${O}`);else if(Q){if(u0[F]!==1)throw new SyntaxError(`Unexpected character at index ${O}`);if(j===-1)j=O;else if(!X)X=!0;Q=!1}else if(Z)if(u0[F]===1){if(j===-1)j=O}else if(F===34&&j!==-1)Z=!1,N=O;else if(F===92)Q=!0;else throw new SyntaxError(`Unexpected character at index ${O}`);else if(F===34&&$.charCodeAt(O-1)===61)Z=!0;else if(N===-1&&u0[F]===1){if(j===-1)j=O}else if(j!==-1&&(F===32||F===9)){if(N===-1)N=O}else if(F===59||F===44){if(j===-1)throw new SyntaxError(`Unexpected character at index ${O}`);if(N===-1)N=O;let I=$.slice(j,N);if(X)I=I.replace(/\\/g,""),X=!1;if(o(K,_,I),F===44)o(J,Y,K),K=Object.create(null),Y=void 0;_=void 0,j=N=-1}else throw new SyntaxError(`Unexpected character at index ${O}`);if(j===-1||Z||F===32||F===9)throw new SyntaxError("Unexpected end of input");if(N===-1)N=O;const P=$.slice(j,N);if(Y===void 0)o(J,P,K);else{if(_===void 0)o(K,P,!0);else if(X)o(K,_,P.replace(/\\/g,""));else o(K,_,P);o(J,Y,K)}return J},J5=function($){return Object.keys($).map((J)=>{let K=$[J];if(!Array.isArray(K))K=[K];return K.map((X)=>{return[J].concat(Object.keys(X).map((Q)=>{let Z=X[Q];if(!Array.isArray(Z))Z=[Z];return Z.map((Y)=>Y===!0?Q:`${Q}=${Y}`).join("; ")})).join("; ")}).join(", ")}).join(", ")},{tokenChars:u0}=v0();e1.exports={format:J5,parse:$5}});var O1=A((O7,z$)=>{var Z$=function($,J,K,X){const Q={protocolVersion:F1[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...X,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(!F1.includes(Q.protocolVersion))throw new RangeError(`Unsupported protocol version: ${Q.protocolVersion} `+`(supported versions: ${F1.join(", ")})`);let Z;if(J instanceof H1)Z=J;else try{Z=new H1(J)}catch(M){throw new SyntaxError(`Invalid URL: ${J}`)}if(Z.protocol==="http:")Z.protocol="ws:";else if(Z.protocol==="https:")Z.protocol="wss:";$._url=Z.href;const Y=Z.protocol==="wss:",_=Z.protocol==="ws+unix:";let j;if(Z.protocol!=="ws:"&&!Y&&!_)j='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https", or "ws+unix:"';else if(_&&!Z.pathname)j="The URL's pathname is empty";else if(Z.hash)j="The URL contains a fragment identifier";if(j){const M=new SyntaxError(j);if($._redirects===0)throw M;else{e0($,M);return}}const F=Y?443:80,N=j5(16).toString("base64"),O=Y?X5.request:Q5.request,P=new Set;let I;if(Q.createConnection=Y?U5:L5,Q.defaultPort=Q.defaultPort||F,Q.port=Z.port||F,Q.host=Z.hostname.startsWith("[")?Z.hostname.slice(1,-1):Z.hostname,Q.headers={...Q.headers,"Sec-WebSocket-Version":Q.protocolVersion,"Sec-WebSocket-Key":N,Connection:"Upgrade",Upgrade:"websocket"},Q.path=Z.pathname+Z.search,Q.timeout=Q.handshakeTimeout,Q.perMessageDeflate)I=new Z0(Q.perMessageDeflate!==!0?Q.perMessageDeflate:{},!1,Q.maxPayload),Q.headers["Sec-WebSocket-Extensions"]=T5({[Z0.extensionName]:I.offer()});if(K.length){for(let M of K){if(typeof M!=="string"||!R5.test(M)||P.has(M))throw new SyntaxError("An invalid or duplicated subprotocol was specified");P.add(M)}Q.headers["Sec-WebSocket-Protocol"]=K.join(",")}if(Q.origin)if(Q.protocolVersion<13)Q.headers["Sec-WebSocket-Origin"]=Q.origin;else Q.headers.Origin=Q.origin;if(Z.username||Z.password)Q.auth=`${Z.username}:${Z.password}`;if(_){const M=Q.path.split(":");Q.socketPath=M[0],Q.path=M[1]}let B;if(Q.followRedirects){if($._redirects===0){$._originalIpc=_,$._originalSecure=Y,$._originalHostOrSocketPath=_?Q.socketPath:Z.host;const M=X&&X.headers;if(X={...X,headers:{}},M)for(let[q,H]of Object.entries(M))X.headers[q.toLowerCase()]=H}else if($.listenerCount("redirect")===0){const M=_?$._originalIpc?Q.socketPath===$._originalHostOrSocketPath:!1:$._originalIpc?!1:Z.host===$._originalHostOrSocketPath;if(!M||$._originalSecure&&!Y){if(delete Q.headers.authorization,delete Q.headers.cookie,!M)delete Q.headers.host;Q.auth=void 0}}if(Q.auth&&!X.headers.authorization)X.headers.authorization="Basic "+Buffer.from(Q.auth).toString("base64");if(B=$._req=O(Q),$._redirects)$.emit("redirect",$.url,B)}else B=$._req=O(Q);if(Q.timeout)B.on("timeout",()=>{y($,B,"Opening handshake has timed out")});if(B.on("error",(M)=>{if(B===null||B[Q$])return;B=$._req=null,e0($,M)}),B.on("response",(M)=>{const q=M.headers.location,H=M.statusCode;if(q&&Q.followRedirects&&H>=300&&H<400){if(++$._redirects>Q.maxRedirects){y($,B,"Maximum redirects exceeded");return}B.abort();let _0;try{_0=new H1(q,J)}catch(n){const p=new SyntaxError(`Invalid URL: ${q}`);e0($,p);return}Z$($,_0,K,X)}else if(!$.emit("unexpected-response",B,M))y($,B,`Unexpected server response: ${M.statusCode}`)}),B.on("upgrade",(M,q,H)=>{if($.emit("upgrade",M),$.readyState!==L.CONNECTING)return;if(B=$._req=null,M.headers.upgrade.toLowerCase()!=="websocket"){y($,q,"Invalid Upgrade header");return}const _0=G5("sha1").update(N+z5).digest("base64");if(M.headers["sec-websocket-accept"]!==_0){y($,q,"Invalid Sec-WebSocket-Accept header");return}const n=M.headers["sec-websocket-protocol"];let p;if(n!==void 0){if(!P.size)p="Server sent a subprotocol but none was requested";else if(!P.has(n))p="Server sent an invalid subprotocol"}else if(P.size)p="Server sent no subprotocol";if(p){y($,q,p);return}if(n)$._protocol=n;const C=M.headers["sec-websocket-extensions"];if(C!==void 0){if(!I){y($,q,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let w;try{w=O5(C)}catch(i){y($,q,"Invalid Sec-WebSocket-Extensions header");return}const b=Object.keys(w);if(b.length!==1||b[0]!==Z0.extensionName){y($,q,"Server indicated an extension that was not requested");return}try{I.accept(w[Z0.extensionName])}catch(i){y($,q,"Invalid Sec-WebSocket-Extensions header");return}$._extensions[Z0.extensionName]=I}$.setSocket(q,H,{generateMask:Q.generateMask,maxPayload:Q.maxPayload,skipUTF8Validation:Q.skipUTF8Validation})}),Q.finishRequest)Q.finishRequest(B,$);else B.end()},e0=function($,J){$._readyState=L.CLOSING,$.emit("error",J),$.emitClose()},L5=function($){return $.path=$.socketPath,K$.connect($)},U5=function($){if($.path=void 0,!$.servername&&$.servername!=="")$.servername=K$.isIP($.host)?"":$.host;return Z5.connect($)},y=function($,J,K){$._readyState=L.CLOSING;const X=new Error(K);if(Error.captureStackTrace(X,y),J.setHeader){if(J[Q$]=!0,J.abort(),J.socket&&!J.socket.destroyed)J.socket.destroy();process.nextTick(e0,$,X)}else J.destroy(X),J.once("error",$.emit.bind($,"error")),J.once("close",$.emitClose.bind($))},T1=function($,J,K){if(J){const X=M5(J).length;if($._socket)$._sender._bufferedBytes+=X;else $._bufferedAmount+=X}if(K){const X=new Error(`WebSocket is not open: readyState ${$.readyState} `+`(${r[$.readyState]})`);process.nextTick(K,X)}},D5=function($,J){const K=this[h];if(K._closeFrameReceived=!0,K._closeMessage=J,K._closeCode=$,K._socket[h]===void 0)return;if(K._socket.removeListener("data",$1),process.nextTick(j$,K._socket),$===1005)K.close();else K.close($,J)},B5=function(){const $=this[h];if(!$.isPaused)$._socket.resume()},I5=function($){const J=this[h];if(J._socket[h]!==void 0)J._socket.removeListener("data",$1),process.nextTick(j$,J._socket),J.close($[H5]);J.emit("error",$)},J$=function(){this[h].emitClose()},W5=function($,J){this[h].emit("message",$,J)},x5=function($){const J=this[h];J.pong($,!J._isServer,X$),J.emit("ping",$)},q5=function($){this[h].emit("pong",$)},j$=function($){$.resume()},G$=function(){const $=this[h];this.removeListener("close",G$),this.removeListener("data",$1),this.removeListener("end",V$),$._readyState=L.CLOSING;let J;if(!this._readableState.endEmitted&&!$._closeFrameReceived&&!$._receiver._writableState.errorEmitted&&(J=$._socket.read())!==null)$._receiver.write(J);if($._receiver.end(),this[h]=void 0,clearTimeout($._closeTimer),$._receiver._writableState.finished||$._receiver._writableState.errorEmitted)$.emitClose();else $._receiver.on("error",J$),$._receiver.on("finish",J$)},$1=function($){if(!this[h]._receiver.write($))this.pause()},V$=function(){const $=this[h];$._readyState=L.CLOSING,$._receiver.end(),this.end()},Y$=function(){const $=this[h];if(this.removeListener("error",Y$),this.on("error",X$),$)$._readyState=L.CLOSING,this.destroy()},K5=W("events"),X5=W("https"),Q5=W("http"),K$=W("net"),Z5=W("tls"),{randomBytes:j5,createHash:G5}=W("crypto"),{Duplex:F7,Readable:T7}=W("stream"),{URL:H1}=W("url"),Z0=w0(),V5=V1(),Y5=Y1(),{BINARY_TYPES:$$,EMPTY_BUFFER:r0,GUID:z5,kForOnEventAttribute:N1,kListener:_5,kStatusCode:H5,kWebSocket:h,NOOP:X$}=J0(),{EventTarget:{addEventListener:N5,removeEventListener:F5}}=r1(),{format:T5,parse:O5}=_1(),{toBuffer:M5}=S0(),Q$=Symbol("kAborted"),F1=[8,13],r=["CONNECTING","OPEN","CLOSING","CLOSED"],R5=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class L extends K5{constructor($,J,K){super();if(this._binaryType=$$[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=r0,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=L.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,$!==null){if(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,J===void 0)J=[];else if(!Array.isArray(J))if(typeof J==="object"&&J!==null)K=J,J=[];else J=[J];Z$(this,$,J,K)}else this._isServer=!0}get binaryType(){return this._binaryType}set binaryType($){if(!$$.includes($))return;if(this._binaryType=$,this._receiver)this._receiver._binaryType=$}get bufferedAmount(){if(!this._socket)return this._bufferedAmount;return this._socket._writableState.length+this._sender._bufferedBytes}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket($,J,K){const X=new V5({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:K.maxPayload,skipUTF8Validation:K.skipUTF8Validation});if(this._sender=new Y5($,this._extensions,K.generateMask),this._receiver=X,this._socket=$,X[h]=this,$[h]=this,X.on("conclude",D5),X.on("drain",B5),X.on("error",I5),X.on("message",W5),X.on("ping",x5),X.on("pong",q5),$.setTimeout)$.setTimeout(0);if($.setNoDelay)$.setNoDelay();if(J.length>0)$.unshift(J);$.on("close",G$),$.on("data",$1),$.on("end",V$),$.on("error",Y$),this._readyState=L.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=L.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}if(this._extensions[Z0.extensionName])this._extensions[Z0.extensionName].cleanup();this._receiver.removeAllListeners(),this._readyState=L.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close($,J){if(this.readyState===L.CLOSED)return;if(this.readyState===L.CONNECTING){y(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===L.CLOSING){if(this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted))this._socket.end();return}this._readyState=L.CLOSING,this._sender.close($,J,!this._isServer,(K)=>{if(K)return;if(this._closeFrameSent=!0,this._closeFrameReceived||this._receiver._writableState.errorEmitted)this._socket.end()}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),30000)}pause(){if(this.readyState===L.CONNECTING||this.readyState===L.CLOSED)return;this._paused=!0,this._socket.pause()}ping($,J,K){if(this.readyState===L.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof $==="function")K=$,$=J=void 0;else if(typeof J==="function")K=J,J=void 0;if(typeof $==="number")$=$.toString();if(this.readyState!==L.OPEN){T1(this,$,K);return}if(J===void 0)J=!this._isServer;this._sender.ping($||r0,J,K)}pong($,J,K){if(this.readyState===L.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof $==="function")K=$,$=J=void 0;else if(typeof J==="function")K=J,J=void 0;if(typeof $==="number")$=$.toString();if(this.readyState!==L.OPEN){T1(this,$,K);return}if(J===void 0)J=!this._isServer;this._sender.pong($||r0,J,K)}resume(){if(this.readyState===L.CONNECTING||this.readyState===L.CLOSED)return;if(this._paused=!1,!this._receiver._writableState.needDrain)this._socket.resume()}send($,J,K){if(this.readyState===L.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof J==="function")K=J,J={};if(typeof $==="number")$=$.toString();if(this.readyState!==L.OPEN){T1(this,$,K);return}const X={binary:typeof $!=="string",mask:!this._isServer,compress:!0,fin:!0,...J};if(!this._extensions[Z0.extensionName])X.compress=!1;this._sender.send($||r0,X,K)}terminate(){if(this.readyState===L.CLOSED)return;if(this.readyState===L.CONNECTING){y(this,this._req,"WebSocket was closed before the connection was established");return}if(this._socket)this._readyState=L.CLOSING,this._socket.destroy()}}Object.defineProperty(L,"CONNECTING",{enumerable:!0,value:r.indexOf("CONNECTING")});Object.defineProperty(L.prototype,"CONNECTING",{enumerable:!0,value:r.indexOf("CONNECTING")});Object.defineProperty(L,"OPEN",{enumerable:!0,value:r.indexOf("OPEN")});Object.defineProperty(L.prototype,"OPEN",{enumerable:!0,value:r.indexOf("OPEN")});Object.defineProperty(L,"CLOSING",{enumerable:!0,value:r.indexOf("CLOSING")});Object.defineProperty(L.prototype,"CLOSING",{enumerable:!0,value:r.indexOf("CLOSING")});Object.defineProperty(L,"CLOSED",{enumerable:!0,value:r.indexOf("CLOSED")});Object.defineProperty(L.prototype,"CLOSED",{enumerable:!0,value:r.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(($)=>{Object.defineProperty(L.prototype,$,{enumerable:!0})});["open","error","close","message"].forEach(($)=>{Object.defineProperty(L.prototype,`on${$}`,{enumerable:!0,get(){for(let J of this.listeners($))if(J[N1])return J[_5];return null},set(J){for(let K of this.listeners($))if(K[N1]){this.removeListener($,K);break}if(typeof J!=="function")return;this.addEventListener($,J,{[N1]:!0})}})});L.prototype.addEventListener=N5;L.prototype.removeEventListener=F5;z$.exports=L});var H$=A((M7,_$)=>{var S5=function($){const J=new Set;let K=-1,X=-1,Q=0;for(Q;Q<$.length;Q++){const Y=$.charCodeAt(Q);if(X===-1&&P5[Y]===1){if(K===-1)K=Q}else if(Q!==0&&(Y===32||Y===9)){if(X===-1&&K!==-1)X=Q}else if(Y===44){if(K===-1)throw new SyntaxError(`Unexpected character at index ${Q}`);if(X===-1)X=Q;const _=$.slice(K,X);if(J.has(_))throw new SyntaxError(`The "${_}" subprotocol is duplicated`);J.add(_),K=X=-1}else throw new SyntaxError(`Unexpected character at index ${Q}`)}if(K===-1||X!==-1)throw new SyntaxError("Unexpected end of input");const Z=$.slice(K,Q);if(J.has(Z))throw new SyntaxError(`The "${Z}" subprotocol is duplicated`);return J.add(Z),J},{tokenChars:P5}=v0();_$.exports={parse:S5}});var M$=A((L7,O$)=>{var m5=function($,J){for(let K of Object.keys(J))$.on(K,J[K]);return function K(){for(let X of Object.keys(J))$.removeListener(X,J[X])}},m0=function($){$._state=2,$.emit("close")},F$=function(){this.destroy()},k0=function($,J,K,X){K=K||J1.STATUS_CODES[J],X={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(K),...X},$.once("finish",$.destroy),$.end(`HTTP/1.1 ${J} ${J1.STATUS_CODES[J]}\r\n`+Object.keys(X).map((Q)=>`${Q}: ${X[Q]}`).join("\r\n")+"\r\n\r\n"+K)},z0=function($,J,K,X,Q){if($.listenerCount("wsClientError")){const Z=new Error(Q);Error.captureStackTrace(Z,z0),$.emit("wsClientError",Z,K,J)}else k0(K,X,Q)},E5=W("events"),J1=W("http"),{Duplex:R7}=W("stream"),{createHash:h5}=W("crypto"),N$=_1(),Y0=w0(),w5=H$(),v5=O1(),{GUID:f5,kWebSocket:C5}=J0(),u5=/^[+/0-9A-Za-z]{22}==$/;class T$ extends E5{constructor($,J){super();if($={maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:v5,...$},$.port==null&&!$.server&&!$.noServer||$.port!=null&&($.server||$.noServer)||$.server&&$.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if($.port!=null)this._server=J1.createServer((K,X)=>{const Q=J1.STATUS_CODES[426];X.writeHead(426,{"Content-Length":Q.length,"Content-Type":"text/plain"}),X.end(Q)}),this._server.listen($.port,$.host,$.backlog,J);else if($.server)this._server=$.server;if(this._server){const K=this.emit.bind(this,"connection");this._removeListeners=m5(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(X,Q,Z)=>{this.handleUpgrade(X,Q,Z,K)}})}if($.perMessageDeflate===!0)$.perMessageDeflate={};if($.clientTracking)this.clients=new Set,this._shouldEmitClose=!1;this.options=$,this._state=0}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');if(!this._server)return null;return this._server.address()}close($){if(this._state===2){if($)this.once("close",()=>{$(new Error("The server is not running"))});process.nextTick(m0,this);return}if($)this.once("close",$);if(this._state===1)return;if(this._state=1,this.options.noServer||this.options.server){if(this._server)this._removeListeners(),this._removeListeners=this._server=null;if(this.clients)if(!this.clients.size)process.nextTick(m0,this);else this._shouldEmitClose=!0;else process.nextTick(m0,this)}else{const J=this._server;this._removeListeners(),this._removeListeners=this._server=null,J.close(()=>{m0(this)})}}shouldHandle($){if(this.options.path){const J=$.url.indexOf("?");if((J!==-1?$.url.slice(0,J):$.url)!==this.options.path)return!1}return!0}handleUpgrade($,J,K,X){J.on("error",F$);const Q=$.headers["sec-websocket-key"],Z=+$.headers["sec-websocket-version"];if($.method!=="GET"){z0(this,$,J,405,"Invalid HTTP method");return}if($.headers.upgrade.toLowerCase()!=="websocket"){z0(this,$,J,400,"Invalid Upgrade header");return}if(!Q||!u5.test(Q)){z0(this,$,J,400,"Missing or invalid Sec-WebSocket-Key header");return}if(Z!==8&&Z!==13){z0(this,$,J,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle($)){k0(J,400);return}const Y=$.headers["sec-websocket-protocol"];let _=new Set;if(Y!==void 0)try{_=w5.parse(Y)}catch(N){z0(this,$,J,400,"Invalid Sec-WebSocket-Protocol header");return}const j=$.headers["sec-websocket-extensions"],F={};if(this.options.perMessageDeflate&&j!==void 0){const N=new Y0(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const O=N$.parse(j);if(O[Y0.extensionName])N.accept(O[Y0.extensionName]),F[Y0.extensionName]=N}catch(O){z0(this,$,J,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){const N={origin:$.headers[`${Z===8?"sec-websocket-origin":"origin"}`],secure:!!($.socket.authorized||$.socket.encrypted),req:$};if(this.options.verifyClient.length===2){this.options.verifyClient(N,(O,P,I,B)=>{if(!O)return k0(J,P||401,I,B);this.completeUpgrade(F,Q,_,$,J,K,X)});return}if(!this.options.verifyClient(N))return k0(J,401)}this.completeUpgrade(F,Q,_,$,J,K,X)}completeUpgrade($,J,K,X,Q,Z,Y){if(!Q.readable||!Q.writable)return Q.destroy();if(Q[C5])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return k0(Q,503);const j=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${h5("sha1").update(J+f5).digest("base64")}`],F=new this.options.WebSocket(null);if(K.size){const N=this.options.handleProtocols?this.options.handleProtocols(K,X):K.values().next().value;if(N)j.push(`Sec-WebSocket-Protocol: ${N}`),F._protocol=N}if($[Y0.extensionName]){const N=$[Y0.extensionName].params,O=N$.format({[Y0.extensionName]:[N]});j.push(`Sec-WebSocket-Extensions: ${O}`),F._extensions=$}if(this.emit("headers",j,X),Q.write(j.concat("\r\n").join("\r\n")),Q.removeListener("error",F$),F.setSocket(Q,Z,{maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients)this.clients.add(F),F.on("close",()=>{if(this.clients.delete(F),this._shouldEmitClose&&!this.clients.size)process.nextTick(m0,this)});Y(F,X)}}O$.exports=T$});class d extends Array{constructor(){super(...arguments)}discardPile=[];props={};set($){return this.splice(0,this.length,...$),this}asArray(){return this}addCard($,J=1){for(let K=0;K<J;K++)this.push($.clone());return this}addCards($){return this.push(...$),this}shuffle(){for(let $=this.length-1;$>0;$--){const J=Math.floor(Math.random()*$),K=this[$];this[$]=this[J],this[J]=K}}reshuffle(){this.push(...this.discardPile),this.discardPile=[],this.shuffle()}draw($=1){let J=[];for(let K=0;K<$;K++){if(this.length===0)this.reshuffle();J.push(this.pop())}return J}static fromCardList($,J){let K={};for(let Y of J){if(!K[Y.getRarity()])K[Y.getRarity()]=0;K[Y.getRarity()]++}let X={},Q=0;for(let Y of Object.keys(K))X[Y]=$*Math.pow(0.75,Object.keys(K).indexOf(Y)),Q+=X[Y];for(let Y of Object.keys(K))X[Y]=Math.round(X[Y]/Q*$);let Z=new d;for(let Y of J)Z.addCard(Y.clone(),X[Y.getRarity()]);return Z}}var U;(function(Q){Q[Q["PLAYER"]=0]="PLAYER";Q[Q["OPPONENT"]=1]="OPPONENT";Q[Q["CARD_IN_HAND"]=2]="CARD_IN_HAND";Q[Q["CARD_IN_DISCARD"]=3]="CARD_IN_DISCARD"})(U||(U={}));var T;(function(H){H[H["SELF"]=0]="SELF";H[H["OPPONENT_MOST_CARDS"]=1]="OPPONENT_MOST_CARDS";H[H["OPPONENT_LEAST_CARDS"]=2]="OPPONENT_LEAST_CARDS";H[H["OPPONENT_RANDOM"]=3]="OPPONENT_RANDOM";H[H["PLAYER_RANDOM"]=4]="PLAYER_RANDOM";H[H["PLAYER_MOST_CARDS"]=5]="PLAYER_MOST_CARDS";H[H["PLAYER_LEAST_CARDS"]=6]="PLAYER_LEAST_CARDS";H[H["CARD_IN_HAND_LEAST_POWER"]=7]="CARD_IN_HAND_LEAST_POWER";H[H["CARD_IN_HAND_MOST_POWER"]=8]="CARD_IN_HAND_MOST_POWER";H[H["CARD_IN_HAND_RANDOM"]=9]="CARD_IN_HAND_RANDOM";H[H["CARD_IN_DISCARD_LEAST_POWER"]=10]="CARD_IN_DISCARD_LEAST_POWER";H[H["CARD_IN_DISCARD_MOST_POWER"]=11]="CARD_IN_DISCARD_MOST_POWER";H[H["CARD_IN_DISCARD_RANDOM"]=12]="CARD_IN_DISCARD_RANDOM";H[H["OPPONENT_MOST_TURNS_REMAINING"]=13]="OPPONENT_MOST_TURNS_REMAINING";H[H["OPPONENT_LEAST_TURNS_REMAINING"]=14]="OPPONENT_LEAST_TURNS_REMAINING";H[H["PLAYER_MOST_TURNS_REMAINING"]=15]="PLAYER_MOST_TURNS_REMAINING";H[H["PLAYER_LEAST_TURNS_REMAINING"]=16]="PLAYER_LEAST_TURNS_REMAINING"})(T||(T={}));var z;(function(_){_[_["BASIC"]=0]="BASIC";_[_["COMMON"]=1]="COMMON";_[_["UNCOMMON"]=2]="UNCOMMON";_[_["RARE"]=3]="RARE";_[_["MYTHIC"]=4]="MYTHIC";_[_["LEGENDARY"]=5]="LEGENDARY";_[_["HAXOR"]=6]="HAXOR"})(z||(z={}));class u{callback;cachedValue;value=!1;constructor($){if(this.callback=$,typeof $!=="function")this.value=!0,this.cachedValue=$}resolve(...$){if(this.value)return this.cachedValue;return this.callback(...$)}getCallback(){return this.callback}}class V{name;abilities=[];power=1;rarity=z.COMMON;canPlay=new u(!0);canGive=new u(!0);discardable=!0;props={};constructor($,J){this.name=$,this.abilities=J}setCanPlay($){return this.canPlay=new u($),this}setCanGive($){return this.canGive=new u($),this}setProps($){return this.props=$,this}setProp($,J,K){return this.props[$]=J,this}addAbility($){return this.abilities.push($),this}getChoices($){return this.orderAbilities().map((J)=>{return J.informChoices({...$,card:this})}).flat()}skipDiscard(){return this.discardable=!1,this}doSkipDiscard(){return!this.discardable}getProps(){return this.props}getProp($){return this.getProps()[$]}clone(){let $=new V(this.name,this.abilities.map((J)=>J.clone()));return $.setPow(this.power),$.setRarity(this.rarity),$.setCanPlay(this.canPlay.getCallback()),$.setCanGive(this.canGive.getCallback()),$.setProps({...this.props}),$}canBePlayed($){if(this.abilities.map((K)=>K.canBePlayed($)).includes(!1))return!1;return this.canPlay.resolve($)}canBeGiven($,J){if(this.abilities.map((X)=>X.canBeGiven($,J)).includes(!1))return!1;return this.canGive.resolve($,J)}setRarity($){return this.rarity=$,this}getRarity(){return this.rarity}getAbilities(){return this.abilities}getWeights($){let J=this.abilities.map((X)=>X.getWeights()),K={play:0,give:0,discard:0};for(let X of J){if(typeof X.play==="function")K.play+=X.play($);else K.play+=X.play;if(typeof X.give==="function")K.give+=X.give($);else K.give+=X.give;if(typeof X.discard==="function")K.discard+=X.discard($);else K.discard+=X.discard}return K}getName(){return this.name}setName($){return this.name=$,this}toCardState(){return{name:this.name,power:this.power,rarity:this.rarity,text:this.getText(),props:this.props}}getLogText(){return`\xA7\xA7${this.name}\xA7card\xA7${JSON.stringify(this.toCardState())}\xA7\xA7`}pow(){return Math.min(this.power,999)}setPow($){if(this.power=$,this.power>999)this.power=999;return this}explode(){let $=[];if(this.getProp("fragment"))return $;else{let J=1;for(let K of this.orderAbilities()){let X=new V(`${this.getName()} Fragment #${J}`,[K.clone()]).setPow(this.pow()).setRarity(this.getRarity()).setProps({...this.props});X.setProp("fragment",!0),J++,$.push(X)}return $}}orderAbilities(){return this.abilities.sort(($,J)=>{if($.constructor.name==="CostAbility"&&J.constructor.name!=="CostAbility")return-1;else if($.constructor.name!=="CostAbility"&&J.constructor.name==="CostAbility")return 1;else if($.constructor.name==="PlayerRestrictionAbility"&&J.constructor.name!=="PlayerRestrictionAbility")return-1;else if($.constructor.name!=="PlayerRestrictionAbility"&&J.constructor.name==="PlayerRestrictionAbility")return 1;else if($.constructor.name==="PlayerRestrictionAbilityNeg"&&J.constructor.name!=="PlayerRestrictionAbilityNeg")return-1;else if($.constructor.name!=="PlayerRestrictionAbilityNeg"&&J.constructor.name==="PlayerRestrictionAbilityNeg")return 1;else if($.constructor.name==="PlayerPredicateRestrictionAbility"&&J.constructor.name!=="PlayerPredicateRestrictionAbility")return-1;else if($.constructor.name!=="PlayerPredicateRestrictionAbility"&&J.constructor.name==="PlayerPredicateRestrictionAbility")return 1;else if($.hasRestriction()&&!J.hasRestriction())return-1;else if(!$.hasRestriction()&&J.hasRestriction())return 1;return 0})}fireEvents($,J){for(let K of this.orderAbilities())K.fireEvents($,J)}play($,J,K,X){let Q=0;if(this.canBePlayed({owner:$,opps:J,deck:K,card:this}))for(let Z of this.orderAbilities()){let Y=X?X[Q]:void 0;Z.fireEvents("play",{owner:$,opps:J,deck:K,card:this,choices:Y}),Q++}}draw($,J,K){for(let X of this.orderAbilities())X.fireEvents("draw",{owner:$,opps:J,deck:K,card:this})}give($,J,K){for(let X of this.orderAbilities())X.fireEvents("give",{owner:$,opps:J,deck:K,card:this})}discard($,J,K){for(let X of this.orderAbilities())X.fireEvents("discard",{owner:$,opps:J,deck:K,card:this})}getText(){return this.orderAbilities().map((J)=>J.getText()).join("\n")}getFormulatedText($){return this.orderAbilities().map((K)=>K.getFormulatedText($)).join("\n")}getFormulas(){return this.orderAbilities().map((J)=>{if(J.hasFormula())return J.getFormula();return""})}getTraits($){let K=this.orderAbilities().map((Q)=>Q.ai()),X={profile:{},meta:{}};for(let Q of K)for(let Z of Object.keys(Q.profile)){let Y=new u(Q.profile[Z]).resolve($);if(X.profile[Z])X.profile[Z]+=Y;else X.profile[Z]=Y}return X.meta={pgp:K.map((Q)=>Q.meta.pgp).flat(),pbp:K.map((Q)=>Q.meta.pbp).flat()},X}static combine(...$){let J=$.map((Q)=>Q.clone()),K=new V(J.map((Q)=>Q.getName()).join(" + "),[...J.map((Q)=>Q.getAbilities()).flat()]);K.setPow(Math.floor(J.map((Q)=>Q.pow()).reduce((Q,Z)=>Q+Z,0)/J.length)),K.setRarity(Math.floor(J.map((Q)=>Q.getRarity()).reduce((Q,Z)=>Q+Z,0)/J.length)),K.setCanPlay((Q)=>{for(let Z of J)if(!Z.canBePlayed(Q))return!1;return!0});let X={};for(let Q of J)X={...X,...Q.getProps()};return K.setProps(X),K}}var B$={Jesse:{collectResource:10,spendResource:-5,affectsSelf:5,affectsOpponents:20,changesGame:5,meme:10,oppWinSetback:50,discardOpponentCards:10},Ian:{collectResource:20,spendResource:10,drawCards:10,changesGame:10,affectsSelf:15}},e=B$;class j0{optimality=1;profile={};profileName="";constructor($=""){if(e[$])this.profileName=$;else this.profileName=Object.keys(e)[Math.floor(Math.random()*Object.keys(e).length)];this.profile=e[$]}getProfileName(){return this.profileName}getProfile(){return this.profile}static makeSpecificChoice($,J){let K=[];if(J.pointer instanceof Function)K.push(J.pointer($));else switch(J.pointer){case T.SELF:K.push($.owner);break;case T.OPPONENT_MOST_CARDS:K.push(...$.opps.sort((Q,Z)=>Z.inHand()-Q.inHand()));break;case T.OPPONENT_LEAST_CARDS:K.push(...$.opps.sort((Q,Z)=>Q.inHand()-Z.inHand()));break;case T.OPPONENT_RANDOM:let X=$.opps.sort(()=>Math.random()-0.5);K.push(...X);break;case T.CARD_IN_DISCARD_LEAST_POWER:K.push(...$.deck.discardPile.sort((Q,Z)=>{if(!Q||!Z)return 0;return Q.pow()-Z.pow()}));break;case T.CARD_IN_DISCARD_MOST_POWER:K.push(...$.deck.discardPile.sort((Q,Z)=>{if(!Q||!Z)return 0;return Z.pow()-Q.pow()}));break;case T.CARD_IN_DISCARD_RANDOM:K.push(...$.owner.cih().sort(()=>Math.random()-0.5));break;case T.CARD_IN_HAND_LEAST_POWER:K.push(...$.owner.cih().sort((Q,Z)=>{if(!Q||!Z)return 0;return Q.pow()-Z.pow()}));break;case T.CARD_IN_HAND_MOST_POWER:K.push(...$.owner.cih().sort((Q,Z)=>{if(!Q||!Z)return 0;return Z.pow()-Q.pow()}));break;case T.CARD_IN_HAND_RANDOM:K.push(...$.owner.cih().sort(()=>Math.random()-0.5));break;case T.PLAYER_RANDOM:K.push(...[$.owner,...$.opps].sort(()=>Math.random()-0.5));break;case T.PLAYER_MOST_CARDS:K.push(...[$.owner,...$.opps].sort((Q,Z)=>Z.inHand()-Q.inHand()));break;case T.PLAYER_LEAST_CARDS:K.push(...[$.owner,...$.opps].sort((Q,Z)=>Q.inHand()-Z.inHand()));break;case T.PLAYER_MOST_TURNS_REMAINING:K.push(...[$.owner,...$.opps].sort((Q,Z)=>Z.getTurns()-Q.getTurns()));break;case T.PLAYER_LEAST_TURNS_REMAINING:K.push(...[$.owner,...$.opps].sort((Q,Z)=>Q.getTurns()-Z.getTurns()));break;case T.OPPONENT_MOST_TURNS_REMAINING:K.push(...$.opps.sort((Q,Z)=>Z.getTurns()-Q.getTurns()));break;case T.OPPONENT_LEAST_TURNS_REMAINING:K.push(...$.opps.sort((Q,Z)=>Q.getTurns()-Z.getTurns()));break}return K}optimalityCrux($){let J=this.optimality,K=$.length,X=(Z)=>{let Y=2*K,_=-(1-J)*Z;return Y*(1-1/(1+Math.E**_))},Q=Math.random()*100;return $[Math.floor(X(Q))]}selectChoices($,J){if(!J.card)return[];else{let K=J.card.getChoices(J),X=[];for(let Q of K)X.push(this.optimalityCrux(j0.makeSpecificChoice(J,Q)))}}evaluate($,J){let K=$.getTraits(J),X=0;for(let Q in K)if(K[Q]!==void 0)X+=K[Q]*this.profile[Q];return X}}class G{text;callback;choices=new u([]);formula="{pow}";weights={play:1,give:1,discard:1};canPlay=new u(!0);canGive=new u(!0);props={};events={};traits={profile:{},meta:{}};constructor($,J,K){this.text=$,this.callback=K,this.choices=new u(J),this.addEvent("play",(X)=>{this.exec(X)})}ai(){return this.traits}sai($,J={}){return this.traits.profile=$,this.traits.meta=J,this}isCostAbility(){return this.props.cost_ability??!1}clone(){let $=new G(this.text,this.choices.resolve(),this.callback);return $.setFormula(this.formula),$.setWeights(this.weights),$.setCanPlay(this.canPlay.getCallback()),$.setCanGive(this.canGive.getCallback()),$.sai(JSON.parse(JSON.stringify(this.ai()))),$}getChoices(){return this.choices.resolve()}getCallback(){return this.callback}setCanPlay($){return this.canPlay=new u($),this}setCanGive($){this.canGive=new u($)}canBePlayed($){return this.canPlay.resolve($)}canBeGiven($,J){return this.canGive.resolve($,J)}setText($){return this.text=$,this}hasRestriction(){return typeof this.canPlay==="function"||!this.canPlay}getText(){return this.text.replace("{formula}",this.textualizeFormula())}getFormulatedText($){return this.text.replace("{formula}",this.calcFormula($))}setWeights($){return this.weights=$,this}getWeights(){return this.weights}informChoices($){return this.choices.resolve($)}setFormula($){return this.formula=$,this}textualizeFormula(){let $=this.formula;for(let J in this.props)$=$.replace(`{${J}}`,this.props[J]);return $}calcFormula($){let J=this.textualizeFormula();return J=J.replace("{pow}",$.card.pow().toString()),(0, eval)(J)}makeChoices($){let J=[];for(let K of this.informChoices($)){let X=j0.makeSpecificChoice($,K),Q=0;if((K.restriction??((Y)=>!0))($)||J.indexOf(X[Q])!==-1&&K.distinct)while(J.indexOf(X[Q])!==-1&&Q<X.length-1)Q++;if(Q>=X.length)J.push(null);J.push(X[Q])}return J}exec($){this.callback($,$.choices??this.makeChoices($))}on($,J){return this.addEvent($,J),this}addEvent($,J){if(!this.events[$])this.events[$]=[];this.events[$].push(J)}removeEvent($){if(this.events[$])delete this.events[$];return this}getEvent($){return this.events[$]}hasFormula(){return this.text.indexOf("{formula}")!==-1}getFormula(){return this.formula}fireEvents($,J){if(this.events[$])for(let K of this.events[$])K(J);if(this.events[`temp_${$}`]){for(let K of this.events[`temp_${$}`])K(J);delete this.events[`temp_${$}`]}}getProps(){return this.props}getProp($){return this.props[$]}setProp($,J){return this.props[$]=J,this}}class U0 extends G{constructor($){super("Increase the power of a card in your hand by {formula}",[{choice:U.CARD_IN_HAND,pointer:T.CARD_IN_HAND_LEAST_POWER}],(J,K)=>{if(J.choices)J.choices[0].setPow(J.choices[0].pow()+$+J.card.pow())});this.sai({improvesCard:(J)=>{return J.pow()+$}}),this.setFormula(`{pow} + ${$}`)}}class m extends G{constructor($){super("Draw {formula} cards",[],(J,K)=>{J.owner.draw(J.deck,J.card.pow()+$)});this.sai({drawsCards:(J)=>J.card.pow()+$}),this.setFormula(`{pow} + ${$}`)}}class p0 extends G{constructor($){super("Each player draws {formula} cards",[],(J,K)=>{J.owner.draw(J.deck,J.card.pow()+$);for(let X of J.opps)X.draw(J.deck,J.card.pow()+$)});this.sai({drawsCards:$,drawsOpponentCards:$}),this.setFormula(`{pow} + ${$}`)}}class H0 extends G{constructor($){super("Opponent discards {formula} cards at random",[{choice:U.OPPONENT,pointer:T.OPPONENT_MOST_CARDS}],(J,K)=>{let X=K[0];for(let Q=0;Q<J.card.pow()+$;Q++){if(X.inHand()===0)break;X.discardChoose(J)}});this.sai({affectsOpponents:(J)=>J.card.pow()+$/J.opps.length,discardsOpponentCards:(J)=>J.card.pow()+$}),this.setWeights({play:3,discard:0,give:-1}),this.setFormula(`{pow} + ${$}`)}}class v extends G{constructor($){super("Discard {formula} cards at random",[],(J,K)=>{J.owner.discardRandom(J)});this.sai({affectsSelf:(J)=>J.card.pow()+$,discardsCards:(J)=>J.card.pow()+$}),this.setFormula(`${$} - {pow}`)}}class A0 extends G{qty;constructor($){super("Player discards hand, then draw {formula} cards",[{choice:U.PLAYER,pointer:(J)=>{if(J.owner.inHand()<=J.card.pow()+$)return J.owner;for(let K of J.opps)if(K.inHand()>J.card.pow()+$)return K;return[J.owner,...J.opps].sort((K,X)=>K.inHand()-X.inHand())[0]}}],(J,K)=>{let X=K.pop();while(X.inHand()>0)J.deck.discardPile.push(X.cih().pop());X.draw(J.deck,this.qty+J.card.pow())});this.sai({discardsCards:(J)=>{let K=J.owner;if(K.selectChoices(this)===K)return K.cih().length;return 0},drawsCards:(J)=>{let K=J.owner;if(K.selectChoices(this)===K)return this.qty+J.card.pow();return 0},discardsOpponentCards:(J)=>{let K=J.owner;if(K.selectChoices(this)!==K)return K.cih().length;return 0},drawsOpponentCards:(J)=>{let K=J.owner;if(K.selectChoices(this)!==K)return this.qty+J.card.pow();return 0},affectsSelf:(J)=>{let K=J.owner;if(K.selectChoices(this)===K)return this.calcFormula(J)-K.cih().length;return K.cih().length-this.calcFormula(J)},affectsOpponents:(J)=>{let K=J.owner;if(K.selectChoices(this)!==K)return(this.calcFormula(J)-K.cih().length)/J.opps.length;return(K.cih().length-this.calcFormula(J))/J.opps.length}}),this.setProp("qty",$),this.setFormula(`{pow} + ${$}`)}}class G0 extends G{constructor(){super("Remove all other copies of this card from the game",[],($,J)=>{let K=$.opps.concat($.owner);for(let X of K)X.setCiH(X.cih().filter((Q)=>{if(!Q||!$.card)return!1;return Q.getName()!==$.card.getName()}));$.deck.set($.deck.filter((X)=>{if(!X||!$.card)return!1;return X.getName()!==$.card.getName()})),$.deck.discardPile=$.deck.discardPile.filter((X)=>{if(!X||!$.card)return!1;return X.getName()!==$.card.getName()}),$.card.skipDiscard(),$.deck.shuffle()});this.sai({changesGame:1})}}class D0 extends G{constructor(){super("Explode a card in your hand. The new cards each have power {formula}.",[{choice:U.CARD_IN_HAND,distinct:!0,pointer:T.CARD_IN_HAND_MOST_POWER,restriction:($)=>{return!$.card.getProp("fragment")}}],($,J)=>{let K=J[0];$.owner.setCiH($.owner.cih().filter((Q)=>Q!==K));let X=K.explode();$.owner.cih().push(...X)});this.sai({drawsCards:($)=>$.owner.selectChoices(this)[0].explode().length-1,improvesCard:($)=>this.calcFormula($)-$.owner.selectChoices(this)[0].pow()})}}class S extends G{constructor($,J){super(`Add {formula} ${J}`,[],(K)=>{let X=this.calcFormula(K),Q=K.owner.getProp(`res_${J}`)??0;K.owner.setProp(`res_${J}`,Q+X,K)});if(this.setWeights({play:2+$,discard:1-$,give:1-$}),this.setProp("resource",!0),!this.getProp("produce"))this.setProp("produce",[]);this.setProp("produce",[...this.getProp("produce"),J]),this.setFormula(`{pow} + ${$}`),this.sai({collectResource:$})}}class D extends G{constructor($,J){super(`Pay {formula} ${$}`,[],(K,X)=>{K.owner.setProp("res_"+$,K.owner.getProp("res_"+$)-Math.max(J,0),K)});this.setProp("cost_ability",!0),this.setCanPlay((K)=>{if(!K.owner)return!1;return K.owner.getProp("res_"+$)>=J}),this.setFormula(`${J} - {pow}`),this.sai({spendResource:(K)=>this.calcFormula(K)},{pgp:["res_"+$]})}}class k extends G{constructor($,J=75,K=!0,X=!1){super(`Add the ${$.replace("_"," ").replace(" deck","")} deck to the game${K?" if it hasn't been already.":""}`,[],(Q)=>{if($0[$]&&(!K||!Q.deck.props[`added_${$}`]))Q.deck.addCards(d.fromCardList(J,$0[$])),Q.deck.shuffle()});if(K&&X)this.setCanPlay((Q)=>{return!Q.deck.props[`added_${$}`]});this.sai({addCardsToDeck:J,changesGame:1}),this.setProp("deck",!0)}}class t extends G{constructor(){super("Play only if you have 0 or less res_life",[],($)=>{});this.setCanPlay(($)=>{return $.owner.getProp("res_life")&&$.owner.getProp("res_life")<=0}),this.sai({},{pbp:["res_life"]})}}class c extends G{constructor($){super(`When this card is drawn, ${$.getText()[0].toLowerCase()+$.getText().substring(1)}`,$.getChoices(),$.getCallback);this.addEvent("draw",(J)=>{this.exec(J)}),this.removeEvent("play")}}class V0 extends G{constructor($,J){super("(event stuff)",[],(K,X)=>{for(let Q of $)K.owner.addEvent(Q,J)});this.sai({affectsSelf:$.length,addEvents:$.length})}}class B0 extends G{constructor($,J){super("(event stuff)",[{choice:U.OPPONENT,pointer:T.OPPONENT_MOST_CARDS}],(K,X)=>{let Q=X[0];for(let Z of $)Q.addEvent(Z,J)});this.sai({addEvents:$.length,affectsOpponents:$.length})}}class I0 extends G{constructor($){super("You can now win.",[],(J,K)=>{J.owner.setCanWin(!0,$)});this.sai({winProgress:100})}}class s extends G{constructor($,J){super("(prop set)",[],(K,X)=>{K.owner.setProp($,J,K)});this.sai({affectsSelf:1})}}class W0 extends G{constructor($){super("Recover {formula} cards",(J)=>{return new Array($).fill({choice:U.CARD_IN_DISCARD,pointer:T.CARD_IN_DISCARD_MOST_POWER,distinct:!0})},(J,K)=>{while(K.length>0){if(J.deck.discardPile.length==0)break;let X=K.pop();J.deck.discardPile.splice(J.deck.discardPile.indexOf(X),1),J.owner.cih().push(X)}});this.setCanPlay((J)=>{if(!J.deck)return!1;return J.deck.discardPile.length>=$}),this.sai({drawsCards:$}),this.setFormula(`${$}`)}}class y0 extends G{constructor(){super("Shuffle the discard pile into the deck",[],($,J)=>{$.deck.reshuffle()})}}class f extends G{constructor($){super(`Play only if you have ${$}`,[],(J)=>{});this.setCanPlay((J)=>{return J.owner.getProp($)}),this.sai({},{pgp:[$]})}}class N0 extends G{constructor($){super(`Play only if you don't have ${$}`,[],(J)=>{});this.sai({},{pbp:[$]}),this.setCanPlay((J)=>{return!J.owner.getProp($)})}}class x0 extends G{constructor($,J){super("(event stuff)",[],(K,X)=>{for(let Q of[K.owner,...K.opps])for(let Z of $)Q.addEvent(Z,J)});this.sai({addEvents:$.length,affectsSelf:$.length,affectsOpponents:(K)=>K.opps.length*$.length})}}class n0 extends G{constructor($,J){super("(prop set)",[],(K,X)=>{[K.owner,...K.opps].forEach((Q)=>Q.setProp($,J,K))});this.sai({affectsSelf:1,affectsOpponents:1},{pbp:[$]})}}class q0 extends G{constructor($,J){super(`${$}`,[],(K)=>{});this.setCanPlay((K)=>{return J(K)})}}class g0 extends G{constructor($){super(`${$}`,[],(J)=>{});this.sai({meme:10})}}class g extends G{constructor($,J=!0){super(`Unlock ${$.getName()} for purchase${J?". Play only if you haven't unlocked it yet.":"."}`,[],(K)=>{if(K.owner.upgrades().filter((X)=>X.getName()===$.getName()).length==0)K.owner.addUpgrade($)});if(J)this.setCanPlay((K)=>{return K.owner.upgrades().filter((X)=>X.getName()===$.getName()).length==0});this.sai({changesGame:1,affectsSelf:1})}}class E{data;effect;infinite=!1;scale=1.1;level=0;constructor($,J,K=!1,X=1.1){this.data=$,this.effect=J,this.infinite=K,this.scale=X}lvl(){return this.level}getCost(){return this.data.cost}getData($){return{name:this.getName(),description:this.getDescription(),cost:this.getCost(),locked:this.data.locked||!this.canPayCost($)}}getName(){return`${this.data.name}${this.infinite&&this.level>0?` Lvl. ${this.level}`:""}`}getDescription(){let $=this.data.description;$=$.replace("{level}",this.level+"");let J=$.match(/{[^}]*}/g);if(J)for(let K of J){let X=K.substring(1,K.length-1);$=$.replace(K,(0, eval)(X))}return $}canPayCost($){let J=$.owner.getResources();for(let K of this.data.cost){if(K.resource=="turns")continue;if(!J[K.resource])return!1;if(J[K.resource]<K.amt)return!1}return!0}payCost($){let J=$.owner.getResources();for(let K of this.data.cost)if(K.resource==="turns"){$.owner.addTurns(K.amt);continue}else $.owner.setProp(`res_${K.resource}`,J[K.resource]-K.amt,$)}locked(){return this.data.locked}unlock($){if(!this.data.locked)if(this.payCost($),this.effect($,this),this.level++,!this.infinite)this.data.locked=!0;else for(let J of this.data.cost)J.amt=Math.ceil(J.amt*this.scale)}}class b0 extends G{constructor($){super("Add {formula} turns to opponent.",[{choice:U.OPPONENT,pointer:T.OPPONENT_LEAST_TURNS_REMAINING}],(J,K)=>{K[0].addTurns($+J.card?.pow())});this.setWeights({play:3,discard:0,give:-1}),this.setFormula(`{pow} + ${$}`),this.sai({oppWinSetback:$,affectsOpponents:(J)=>$/J.opps.length,winProgress:(J)=>$/J.opps.length/2})}}class F0 extends G{constructor(){super("You become innoculated with propaganda. You're an antivaxxer now.",[],($,J)=>{$.owner.setProp("antivaxxer",!0)});this.sai({meme:100,changesGame:1,affectsSelf:($)=>$.owner.getProp("antivaxxer")?0:-10},{pbp:["antivaxxer","zombie","res_life"]})}}var I$={radioactivity_deck:[new V("Nuclear Observation",[new V0(["draw"],($)=>{if($.card.getProp("radioactive"))$.owner.setProp("knowledge",($.owner.getProp("knowledge")??0)+5,$),$.owner.draw($.deck,1)}).setText("When you draw a radioactive card, gain {formula} knowledge and draw another card.").setFormula("{pow} + 5")]).setRarity(z.LEGENDARY),new V("Decay",[new c(new v(1)),new v(1)]).setRarity(z.BASIC).setProp("radioactive",!0),new V("Fusion",[new c(new G("If you have other cards in your hand, combine {formula} of them at random",[],($,J)=>{let K=$.owner.cih();if(K.length>2){let X=K.splice(Math.floor(Math.random()*K.length),1)[0],Q=K.splice(Math.floor(Math.random()*K.length),1)[0],Z=V.combine(X,Q);$.owner.cih().push(Z)}})),new v(1)]).setRarity(z.UNCOMMON).setProp("radioactive",!0),new V("Fission",[new c(new V0(["temp_draw"],($)=>{let J=$.card;$.owner.setCiH($.owner.cih().filter((X)=>X!==J));let K=J.explode().sort((X,Q)=>Math.random()-0.5);$.owner.cih().push(K.pop()),$.deck.discardPile.push(...K)}).setText("The next card you draw explodes. Keep one fragment at random, and discard the rest.")),new v(1)]).setRarity(z.RARE).setProp("radioactive",!0)],genetics_deck:[new V("Gene Bank",[new D("metal",20),new f("genetics"),new N0("gene_bank"),new s("gene_bank",!0)]).setRarity(z.RARE).setProp("construction",!0),new V("Analyze Card DNA",[new f("genetics"),new f("gene_bank"),new S(5,"knowledge"),new G("Analyze a card in the discard pile to add its DNA to the gene bank.",[{choice:U.CARD_IN_DISCARD,pointer:T.CARD_IN_DISCARD_RANDOM}],($,J)=>{if(!$.owner.getProp("dna_research"))$.owner.setProp("dna_research",[],$);let K=J[0];for(let X of K.getAbilities())$.owner.getProp("dna_research").push(X);$.deck.discardPile=$.deck.discardPile.filter((X)=>X!==K)})]).setRarity(z.UNCOMMON),new V("Spank Bank Variety",[new G("If you have {formula} or more entries in your gene bank, you win the game on your next turn.",[],($,J)=>{if(($.owner.getProp("dna_research")??[]).length>=30-$.card.pow())$.owner.setCanWin(!0,"Genetic Superiority")}).setFormula("30 - {pow}")]).setRarity(z.LEGENDARY)],explosives_deck:[new V("Grenade",[new f("explosives"),new G("Explode a card at random in an opponents hand, then they discard half that many cards at random.",[{choice:U.OPPONENT,pointer:T.OPPONENT_LEAST_CARDS}],($,J)=>{let K=J[0],X=K.cih()[Math.floor(Math.random()*K.cih().length)];if(X){K.setCiH(K.cih().filter((Y)=>Y!==X));let Q=X.explode(),Z=Math.ceil(Q.length/2);K.cih().push(...Q);for(let Y=0;Y<Z;Y++)K.discardChoose($)}})]),new V("Dynamite",[new f("explosives"),new G("Explode all cards in the discard pile",[],($,J)=>{let K=$.deck.discardPile;$.deck.discardPile=[];for(let X of K){let Q=X.explode();$.deck.discardPile.push(...Q)}}),new G("Destroy half the cards in the discard pile at random",[],($,J)=>{let K=$.deck.discardPile;$.deck.discardPile=[];let X=Math.ceil(K.length/2);for(let Q=0;Q<X;Q++)$.deck.discardPile.push(K.splice(Math.floor(Math.random()*K.length),1)[0])}),new W0(1)]).setRarity(z.RARE),new V("Nuclear Bomb",[new f("explosives"),new G("Kill everyone. They discard their hands",[],($,J)=>{let K=[...$.opps,$.owner];for(let X of K)X.setProp("res_life",0,$),$.deck.discardPile.concat(X.cih()),X.setCiH([])}),new G("Kill everyone's citizens.",[],($,J)=>{let K=[...$.opps,$.owner];for(let X of K)X.setProp("population",0,$)}),new G("Explode all cards in the discard pile",[],($,J)=>{let K=$.deck.discardPile;$.deck.discardPile=[];for(let X of K){let Q=X.explode();$.deck.discardPile.push(...Q)}}),new y0,new k("radioactivity_deck",30,!0)]).setRarity(z.HAXOR)],academia_deck:[new V("The Scientific Process",[new D("knowledge",5),new g(new E({name:"Rapid Iteration",description:"When you draw a card, if you have more cards than your maximum hand size, randomly combine cards.",cost:[{amt:25,resource:"knowledge"}]},($)=>{$.owner.addEvent("draw",(J)=>{if(J.owner.cih().length>J.owner.getHandsize()&&J.owner.cih().length>=2)while(J.owner.cih().length>J.owner.getHandsize()&&J.owner.cih().length>=2){let K=J.owner.cih().sort(()=>Math.random()-0.5).slice(0,2),X=V.combine(...K);X.setProp("hybrid",!0),J.owner.cih().push(X),J.owner.cih().splice(J.owner.cih().indexOf(K[0]),1),J.owner.cih().splice(J.owner.cih().indexOf(K[1]),1)}})}))]).setRarity(z.RARE),new V("Thought that Counts",[new S(1,"knowledge")]).setRarity(z.BASIC),new V("Receive Public Education",[new S(1,"knowledge"),new m(1),new v(1)]).setRarity(z.COMMON),new V("Homeschooling",[new S(5,"knowledge"),new F0]).setRarity(z.RARE),new V("Go to University",[new D("tadbucks",10),new S(5,"knowledge"),new m(1)]).setRarity(z.UNCOMMON),new V("Pseudo-Education",[new S(2,"knowledge"),new F0,new k("alchemy_deck",75,!0).setText("Invent alchemy and witchcraft. Add them to the game.")]),new V("Research: Explosives",[new D("knowledge",15),new s("explosives",!0).setCanPlay(($)=>{return!$.owner.getProp("explosives")}).setText("Discover explosives if you haven't already."),new k("explosives_deck",35,!0).setText("Invent explosives. Add them to the game.")]).setProp("research",!0),new V("Research: Genetics",[new D("knowledge",20),new s("genetics",!0).setCanPlay(($)=>{return!$.owner.getProp("genetics")}).setText("Discover genetics if you haven't already."),new k("genetics_deck",35,!0).setText("Invent genetics. You learn cards are sentient. Add it to the game.")])],basic_resource_deck:[new V("Wood Shipment",[new g(new E({name:"Wood Shipment",description:"Order {Math.floor(10 * Math.pow(1.15, {level} + 1)} wood from the Amazon",cost:[{amt:20,resource:"tadbucks"}],locked:!1},($,J)=>{$.owner.addResource("wood",Math.floor(10*Math.pow(1.15,J.lvl())))},!0,1.25))]),new V("Food Shipment",[new g(new E({name:"Wood Shipment",description:"Order {Math.floor(10 * Math.pow(1.15, {level} + 1)} food from the Amazon",cost:[{amt:20,resource:"tadbucks"}],locked:!1},($,J)=>{$.owner.addResource("food",Math.floor(10*Math.pow(1.15,J.lvl())))},!0,1.25))]),new V("Metal Shipment",[new g(new E({name:"Wood Shipment",description:"Order {Math.floor(10 * Math.pow(1.15, {level} + 1)} metal from the Amazon",cost:[{amt:20,resource:"tadbucks"}],locked:!1},($,J)=>{$.owner.addResource("metal",Math.floor(10*Math.pow(1.15,J.lvl())))},!0,1.25))]),new V("Stone Shipment",[new g(new E({name:"Wood Shipment",description:"Order {Math.floor(10 * Math.pow(1.15, {level} + 1)} stone from the Amazon",cost:[{amt:20,resource:"tadbucks"}],locked:!1},($,J)=>{$.owner.addResource("stone",Math.floor(10*Math.pow(1.15,J.lvl())))},!0,1.25))]),new V("Gather Wood",[new S(0,"wood")]).setRarity(z.BASIC).setProp("resource",!0),new V("Gather Stone",[new S(0,"stone")]).setRarity(z.BASIC).setProp("resource",!0),new V("Gather Metal",[new S(0,"metal")]).setRarity(z.BASIC).setProp("resource",!0),new V("Gather Food",[new S(0,"food")]).setRarity(z.BASIC).setProp("resource",!0),new V("Collect Taxes",[new G("Gain {formula} Tadbucks for each citizen you have.",[],($,J)=>{$.owner.setProp("tadbucks",($.owner.getProp("tadbucks")??0)+$.owner.getProp("population")*($.card.pow()*10),$)}).setFormula("{pow} * 10")]).setRarity(z.UNCOMMON),new V("Construct Cottage",[new D("wood",5),new D("food",5),new G("Build a cottage. (Adds {formula} housing)",[],($,J)=>{$.owner.setProp("housing",$.card.pow()+($.owner.getProp("housing")??0),$)}),new V0(["turn_start"],($)=>{if($.owner.getProp("housing")>$.owner.getProp("population"))$.owner.setProp("population",($.owner.getProp("population")??0)+1,$)}).setText("At the start of your turn, if you have housing, people move in.")]).setRarity(z.COMMON).setProp("construction",!0),new V("Marketplace Construction",[new N0("marketplace"),new D("wood",5),new D("stone",5),new s("marketplace",!0).setText("Unlocks the marketplace"),new G("Get a stimmy check of {formula} tadbucks",[],($,J)=>{$.owner.setProp("tadbucks",($.owner.getProp("tadbucks")??0)+$.card.pow()*10,$)}).setFormula("100 + (10 * {pow})")]).setRarity(z.MYTHIC).setProp("construction",!0),new V("Research: Improved Agricultural Practices",[new D("knowledge",8),new G("Increase the power of all cards that produce food by {formula}",[],($,J)=>{let K=[...$.opps,$.owner];for(let X of K)for(let Q of X.cih())if(Q.getProp("produce")&&Q.getProp("produce").includes("food"))Q.setPow(Q.pow()+$.card.pow());for(let X of $.deck.discardPile)if(X.getProp("produce")&&X.getProp("produce").includes("food"))X.setPow(X.pow()+$.card.pow());for(let X of $.deck.asArray())if(X.getProp("produce")&&X.getProp("produce").includes("food"))X.setPow(X.pow()+$.card.pow())})]).setRarity(z.RARE).setProp("research",!0),new V("Research: Improved Logging Practices",[new D("knowledge",8),new G("Increase the power of all cards that produce wood by {formula}",[],($,J)=>{let K=[...$.opps,$.owner];for(let X of K)for(let Q of X.cih())if(Q.getProp("produce")&&Q.getProp("produce").includes("wood"))Q.setPow(Q.pow()+$.card.pow());for(let X of $.deck.discardPile)if(X.getProp("produce")&&X.getProp("produce").includes("wood"))X.setPow(X.pow()+$.card.pow());for(let X of $.deck.asArray())if(X.getProp("produce")&&X.getProp("produce").includes("wood"))X.setPow(X.pow()+$.card.pow())})]).setRarity(z.RARE).setProp("research",!0),new V("Research: Improved Quarrying Practices",[new D("knowledge",8),new G("Increase the power of all cards that produce stone by {formula}",[],($,J)=>{let K=[...$.opps,$.owner];for(let X of K)for(let Q of X.cih())if(Q.getProp("produce")&&Q.getProp("produce").includes("stone"))Q.setPow(Q.pow()+$.card.pow());for(let X of $.deck.discardPile)if(X.getProp("produce")&&X.getProp("produce").includes("stone"))X.setPow(X.pow()+$.card.pow());for(let X of $.deck.asArray())if(X.getProp("produce")&&X.getProp("produce").includes("stone"))X.setPow(X.pow()+$.card.pow())})]).setRarity(z.RARE).setProp("research",!0),new V("Research: Improved Mining Practices",[new D("knowledge",8),new G("Increase the power of all cards that produce metal by {formula}",[],($,J)=>{let K=[...$.opps,$.owner];for(let X of K)for(let Q of X.cih())if(Q.getProp("produce")&&Q.getProp("produce").includes("metal"))Q.setPow(Q.pow()+$.card.pow());for(let X of $.deck.discardPile)if(X.getProp("produce")&&X.getProp("produce").includes("metal"))X.setPow(X.pow()+$.card.pow());for(let X of $.deck.asArray())if(X.getProp("produce")&&X.getProp("produce").includes("metal"))X.setPow(X.pow()+$.card.pow())})]).setRarity(z.RARE).setProp("research",!0)],zombie_deck:[new V("Chomp",[new t,new G("Deal {formula} damage to an opponent. They discard that many cards.",[{pointer:T.OPPONENT_MOST_CARDS,choice:U.OPPONENT}],($,J)=>{let K=J[0],X=$.card.pow()*5;if($.owner.getProp("res_life")<=0){K.setProp("res_life",K.getProp("res_life")-X,$);for(let Q=0;Q<X;Q++)K.discardChoose($)}}).setFormula("{pow} * 5")]).setRarity(z.COMMON),new V("Brain Munchies",[new t,new G("Draw {formula} cards.",[],($,J)=>{if($.owner.getProp("res_life")<=0)$.owner.draw($.deck,$.card.pow())}).setFormula("{pow} + 2")]).setRarity(z.COMMON),new V("X-49 Antigen",[new G("Play only if you aren't an antivaxxer.",[],($,J)=>{}).setCanPlay(($)=>{return!$.owner.getProp("antivaxxer")}),new G("Heal all zombies. They give you their hands out of gratitude.",[],($,J)=>{if(!$.owner.getProp("antivaxxer"))for(let K of $.opps)K.setProp("res_life",10,$),$.owner.setCiH($.owner.cih().concat(K.cih())),K.setCiH([])})]).setCanPlay(($)=>{return!$.owner.getProp("antivaxxer")}).setRarity(z.RARE),new V("Necromutation",[new t,new D0,new U0(2)]).setRarity(z.RARE),new V("Zombie Sutures",[new t,new G("Combine the top three non-sutured cards in the discard pile, then add it to your hand {formula} times",[],($,J)=>{let K=$.deck.discardPile.filter((X)=>X&&X!==$.card&&!X.getProp("sutured"));if(K=K.slice(0,3),K.length>0){let X=new V(`Sutured ${K.map((Q)=>Q.clone().getName()).join("-")}`,[...K.map((Q)=>{return Q.clone().getAbilities()}).flat()]).setRarity(z.HAXOR).setProp("sutured",!0);$.deck.discardPile=$.deck.discardPile.filter((Q)=>{return!K.includes(Q)});for(let Q=0;Q<$.card.pow();Q++)$.owner.cih().push(X.clone())}}).setFormula("{pow}")]),new V("Rot Brains",[new t,new G("Zombify half the cards in an opponents hand. (They can't play them unless they are a zombie)",[{choice:U.OPPONENT,pointer:T.OPPONENT_MOST_CARDS}],($,J)=>{let K=J[0],X=K.cih(),Q=Math.ceil(X.length/2),Z=X.map((Y,_)=>Y.clone()).sort(()=>Math.random()-0.5);for(let Y=0;Y<Q;Y++)Z[Y]=new V(`Zombified ${Z[Y].getName()}`,[new t,...Z[Y].getAbilities()]).setPow(Z[Y].pow()).setRarity(Z[Y].getRarity()).setProps({zombie:!0,...Z[Y].getProps()});K.setCiH(Z)})])],alchemy_deck:[new V("Curse of Cuckage",[new c(new m(1)),new B0(["temp_can_win"],($)=>{$.owner.setCanWin(!1,"cards in hand")}).setText("The next time an opponent tries to win, they don't.")]).setRarity(z.HAXOR).setProp("curse",!0),new V("Rite of Suffering",[new D("population",3),new G("Each opponent discards {formula} cards.",[],($,J)=>{for(let K of $.opps)for(let X=0;X<3;X++)K.discardChoose($)}).setFormula("3 + {pow}")]).setRarity(z.MYTHIC).setProp("curse",!0),new V("Curse of Apathy",[new c(new G("Increase your cards to win by {formula}",[],($,J)=>{$.owner.addTurns($.card.pow())})).setFormula("{pow}"),new v(1)]).setRarity(z.COMMON).setProp("curse",!0),new V("Curse of Suffering",[new c(new G("Lose {formula} life.",[],($,J)=>{if(!$.owner.getProp("res_life"))$.owner.setProp("res_life",1,$);$.owner.setProp("res_life",$.owner.getProp("res_life")-(3+$.card.pow()),$)})).setFormula("3 + {pow}"),new v(1)]).setRarity(z.COMMON).setProp("curse",!0).setCanGive(!1),new V("Curse of Decay",[new c(new v(1)),new B0(["temp_turn_end"],($)=>{$.owner.discardChoose($),$.owner.discardChoose($)}).setText("Choose an opponent. They discard two cards at the end of their next turn.")]).setProp("curse",!0),new V("Connive",[new m(1),new G("Copy a curse in your hand, then put it on top of the deck.",[{choice:U.CARD_IN_HAND,pointer:T.CARD_IN_HAND_MOST_POWER,restriction:($)=>{return $.owner.cih().filter((J)=>J.getProp("curse")).length>0}}],($,J)=>{let K=J[0];$.deck.push(K.clone())}).setCanPlay(($)=>{return $.owner.cih().filter((J)=>J.getProp("curse")).length>0})]).setRarity(z.RARE)],gambling_deck:[new V("Lady Fortune's Favor",[new f("dice"),new D("tadbucks",20),new v(1),new G("Roll your dice. If you get a {formula} or more, you win the game.",[],($,J)=>{if($.owner.rollDice()>=100-$.card.pow())$.owner.setCanWin(!0,"had Lady Fortune's favor")}).setFormula("100 - {pow}")]).setRarity(z.MYTHIC),new V("Street Modding",[new f("dice"),new D("tadbucks",15),new G("Add {formula} pips at random to your dice.",[],($,J)=>{let K=3+$.card.pow(),X=[...$.owner.getProp("dice")??[-1]];for(let Q=0;Q<K;Q++)X[Math.floor(Math.random()*X.length)]++;$.owner.setProp("dice",X,$)}).setFormula("3 + {pow}")]).setRarity(z.UNCOMMON),new V("Government Grade Fortunator",[new f("dice"),new D("tadbucks",100),new G("Add {formula} pips at random to your dice.",[],($,J)=>{let K=10+$.card.pow(),X=[...$.owner.getProp("dice")??[-1]];for(let Q=0;Q<K;Q++)X[Math.floor(Math.random()*X.length)]++;$.owner.setProp("dice",X,$)}).setFormula("10 + {pow}")]).setRarity(z.RARE),new V("Dimensionality Tear",[new f("explosives"),new f("dice"),new D("tadbucks",20),new D("knowledge",10),new G("Add 2 sides to your dice, each with pips equal to the total of the rest of the sides of the dice.",[],($,J)=>{let K=$.owner.getProp("dice").reduce((X,Q)=>X+Q,0);$.owner.setProp("dice",$.owner.getProp("dice").concat([K,K]),$)})]).setRarity(z.MYTHIC),new V("Gambling Insurance",[new f("casino"),new D("tadbucks",50),new V0(["gamble_lose"],($)=>{$.owner.setProp("tadbucks",($.owner.getProp("tadbucks")??0)+$.card.pow()*10,$)}).setText("Whenever you lose at gambling, you gain {formula} Tadbucks.").setFormula("{pow} * 10")]).setRarity(z.LEGENDARY)],currency_deck:[new V("Telemarketing",[new D("tadbucks",50),new g(new E({name:"Telemarketing",description:"Outsource cold-calling all your opponents, wasting their time.",cost:[{amt:15,resource:"tadbucks"}]},($)=>{$.opps.forEach((J)=>{J.addTurns(2)})},!0,1.35)).setText("Unlocks telemarketing as a way to waste your opponents time.")]).setRarity(z.RARE),new V("Welfare Handouts",[new G("Cards in your hand lose all costs",[],($,J)=>{let K=$.owner.cih();for(let X=0;X<K.length;X++)K[X]=new V(K[X].getName(),[...K[X].getAbilities().map((Q)=>{return Q.clone()}).filter((Q)=>{return!Q.isCostAbility()})]).setPow(K[X].pow()).setRarity(K[X].getRarity()).setProps(K[X].getProps())})]).setRarity(z.LEGENDARY),new V("Moneybags $$$",[new D("tadbucks",2000),new I0("achieving wealth")]).setRarity(z.LEGENDARY),new V("Communism",[new G("Collect all cards from all hands, shuffle them together, then distribute them evenly to all players",[],($,J)=>{let K=[];for(let Q of[$.owner,...$.opps])while(Q.inHand()>0)K.push(Q.cih().pop());let X=0;while(K.length>0)[$.owner,...$.opps][X%[$.owner,...$.opps].length].cih().push(K.pop()),X++})]).setRarity(z.MYTHIC),new V("The House Always Wins",[new D("tadbucks",25),new N0("casino"),new s("casino",!0).setText("Unlocks membership to the casino."),new s("dice",[1,2,3,4,5,6]).setText("Unlocks a basic 6-sided dice"),new k("gambling_deck",50,!0).setText("Invent gambling. Add it to the game.")]).setRarity(z.MYTHIC),new V("Payday",[new G("Get paid. Earn {formula} Tadbucks.",[],($)=>{$.owner.setProp("tadbucks",($.owner.getProp("tadbucks")??0)+15*$.card.pow(),$)}).setFormula("15 * {pow}")]).setRarity(z.BASIC),new V("Bonus Check",[new G("Get paid. Earn {formula} Tadbucks.",[],($)=>{$.owner.setProp("tadbucks",($.owner.getProp("tadbucks")??0)+25*$.card.pow(),$)}).setFormula("25 * {pow}")]).setRarity(z.COMMON),new V("Corporate Sabotage",[new D("tadbucks",20),new H0(3)]).setRarity(z.RARE),new V("Inflationary Hedging",[new D("tadbucks",35),new G("Increase the power of all cards in your hand and the deck that mention Tadbucks by {formula}",[],($,J)=>{for(let K of $.owner.cih()){if(!K)continue;if(K===$.card)continue;if(K.getText().toLowerCase().includes("tadbuck")||K.getName().toLowerCase().includes("tadbuck"))K.setPow(K.pow()+$.card.pow())}for(let K of $.deck.asArray()){if(!K)continue;if(K.getText().toLowerCase().includes("tadbuck")||K.getName().toLowerCase().includes("tadbuck"))K.setPow(K.pow()+$.card.pow())}})]).setRarity(z.RARE),new V("Marketplace Economics",[new D("tadbucks",50),new k("basic_resource_deck",75,!1).setText("Invent market economics. Add basic resources to the game.")])],life_deck:[new V("Job Interview",[new g(new E({name:"Get a Job",description:"Search for a job in Alaska.",cost:[{amt:3,resource:"turns"}],locked:!1},($)=>{$.owner.addUpgrade(new E({name:"Work",description:"Work for 65 Tadbucks.",cost:[{amt:1,resource:"turns"}]},(K)=>{K.owner.addResource("tadbucks",65)},!0,1.5))}))]).setRarity(z.UNCOMMON),new V("Phlebotomy",[new g(new E({name:"Blood Drawing",description:"Take some time to do research on your blood. You get paid for it!",cost:[{amt:1,resource:"turns"},{amt:3,resource:"life"}]},($)=>{$.owner.addResource("tadbucks",5),$.owner.addResource("knowledge",5)},!0,1.2))]).setRarity(z.UNCOMMON),new V("Crusader Kings III Level of Immortality",[new D("life",2500),new I0("achieving immortality")]).setRarity(z.MYTHIC),new V("Going to the Gym",[new G("Gain {formula} life",[],($,J)=>{$.owner.setProp("res_life",$.owner.getProp("res_life")+5*$.card.pow(),$)}).setFormula("5 * {pow}")]).setRarity(z.COMMON),new V("Assassinate",[new G("Kill an opponent. They discard their hand.",[{pointer:T.OPPONENT_MOST_CARDS,choice:U.OPPONENT}],($,J)=>{let K=J[0];K.setProp("res_life",0,$);while(K.inHand()>0)K.discard(K.cih()[0],$.deck)})]).setRarity(z.HAXOR),new V("Soul Cancer",[new G("Whenever you play a card, lose {formula} life",[],($,J)=>{$.owner.addEvent("play",(K)=>{if(!K.owner.getProp("res_life"))K.owner.setProp("res_life",K.card.pow(),K);K.owner.setProp("res_life",K.owner.getProp("res_life")-K.card.pow(),K)})})]).setRarity(z.RARE),new V("2024 Presidential Debate",[new F0,new m(1)]).setRarity(z.UNCOMMON)],point_deck:[new V("Point of Pity",[new G("If you have -{formula} or fewer points, you win the game on your next turn",[],($,J)=>{if($.owner.getProp("points")<=-(100-$.card.pow()))$.owner.setCanWin(!0,"had a point of pity")}).setFormula("100 - {pow}")]).setRarity(z.RARE),new V("Pointlessify",[new G("Reduce all point values in an opponents hand to -1. Gain points equal to the difference.",[{pointer:T.OPPONENT_MOST_CARDS,choice:U.OPPONENT}],($,J)=>{let K=J[0],X=0;for(let Q of K.cih())if(Q.getProp("point_value")){if(Q.getProp("point_value")>-1)X+=Q.getProp("point_value")+1;Q.setProp("point_value",-1)}$.owner.setProp("points",($.owner.getProp("points")??0)+X,$)})]).setRarity(z.RARE),new V("Pontificate",[new G("Gain {formula} points.",[],($,J)=>{$.owner.setProp("points",$.owner.getProp("points")+$.card.pow(),$)}),new G("Randomly add points to all cards in the deck",[],($,J)=>{for(let K of $.deck)if(K.getProp("point_value"))K.setProp("point_value",K.getProp("point_value")+Math.floor(Math.random()*K.pow()));else K.setProp("point_value",[-K.pow(),0,0,1,1,K.pow()].sort((X,Q)=>Math.random()-0.5)[0])})]).setRarity(z.BASIC)],faith_deck:[new V("Thoughts and Prayers",[new S(1,"faith"),new m(1),new G("Slow your roll. You pray instead of getting closer to winning",[],($,J)=>$.owner.addTurns(1))]).setRarity(z.BASIC)],basic:[new V("Oozify",[new G("Choose a card in your hand. Split it into {formula} weaker cards.",[{pointer:T.CARD_IN_HAND_MOST_POWER,choice:U.CARD_IN_HAND}],($,J)=>{let K=J[0],X=[];for(let Q=0;Q<$.card.pow();Q++){let Z=K.clone().setPow(Math.floor(1/$.card.pow()*K.pow()));Z.setName(`Oozing ${Z.getName()}`),Z.setRarity(Math.max(0,Z.getRarity()-1)),X.push(Z)}$.owner.cih().splice($.owner.cih().indexOf(K),1),$.owner.cih().push(...X)}).setCanPlay(($)=>{return $.owner.cih().length>1}).setFormula("{pow} + 1")]).setRarity(z.RARE),new V("You Could Make a Religion Outta This",[new k("faith_deck",75,!0).setText("Invent religion."),new S(1,"faith"),new G0]).setRarity(z.RARE),new V("What's the Point?",[new k("point_deck",75,!0).setText("Invent points. Add points to the game."),new n0("points_to_win",100).setText("First player to 100 points wins on their next turn!"),new x0(["play"],($)=>{if($.card.getProp("point_value")){let J=$.card.getProp("point_value")??0;J*=0.75+$.card.pow()*0.25,$.owner.setProp("points",($.owner.getProp("points")??0)+J,$)}}).setText("Whenever someone plays a card, they get however many points that card is worth."),new x0(["points_change"],($)=>{if($.owner.getProp("points")>=$.owner.getProp("points_to_win"))$.owner.setCanWin(!0,"saw the point")}).setText("Every time someone's score changes, check if they can win."),new G("For each card in the deck, assign a random point value!",[],($,J)=>{let K=[-7,-5,-3,-2,-2,-1,-1,-1,-1,-1,0,0,0,0,0,0,1,1,1,1,1,1,2,2,3,3,5,10];for(let X of $.deck.asArray())X.setProp("point_value",K[Math.floor(Math.random()*K.length)])}),new G0]).setRarity(z.LEGENDARY),new V("Agonize over a Decision",[new m(3),new v(3)]).setRarity(z.UNCOMMON),new V("Skip Bitch",[new G("Skip an opponents turn",[{pointer:T.OPPONENT_MOST_CARDS,choice:U.OPPONENT}],($,J)=>{J[0].skip()})]).setRarity(z.UNCOMMON),new V("Megaskip Bitch",[new G("Skip an opponents next {formula} turns",[{pointer:T.OPPONENT_MOST_CARDS,choice:U.OPPONENT}],($,J)=>{let K=J[0];K.skip(),K.skip()}).setFormula("1 + {pow}")]).setRarity(z.HAXOR),new V("Housing Economy Crash",[new G("Each player discards all cards above common rarity",[],($,J)=>{let K=[$.owner,...$.opps];for(let X of K){let Q=X.cih().filter((Z)=>{if(!Z)return!1;return Z.getRarity()>z.COMMON});for(let Z of Q)X.discard(Z,$.deck)}})]).setRarity(z.RARE),new V("Tactical Cuckage",[new H0(2),new v(3),new G("Make an opponent skip a turn",[{pointer:T.OPPONENT_MOST_CARDS,choice:U.OPPONENT}],($,J)=>{J[0].skip()}),new m(1)]).setRarity(z.MYTHIC),new V("Supercharge",[new U0(1)]).setRarity(z.UNCOMMON),new V("Gifts of Giving",[new m(1),new p0(1)]).setRarity(z.COMMON),new V("Minor Cucking",[new H0(1)]).setRarity(z.COMMON),new V("Gifted Sabotage",[new v(2)]).setRarity(z.COMMON),new V("Basic Bitchery",[new m(1)]).setRarity(z.BASIC),new V("Change of Perspective",[new A0(2)]).setRarity(z.RARE),new V("Speedbump",[new G("Increase everyone else's cards to play by {formula}",[],($,J)=>{$.opps.forEach((K)=>{K.addTurns($.card.pow())})})]).setRarity(z.BASIC),new V("Encrust in Gold",[new G("Increase a card in your hands rarity. It gains {formula} power",[{choice:U.CARD_IN_HAND,pointer:T.CARD_IN_HAND_LEAST_POWER}],($,J)=>{let K=J[0];K.setRarity(K.getRarity()+1),K.setPow(K.pow()+$.card.pow()+2),K.setName(`Golden ${K.getName()} \uD83D\uDCB0\uD83D\uDCB0`)}).setFormula("{pow} + 2")]).setRarity(z.RARE),new V("Scrap Buyback",[new W0(1).setFormula("{pow}")]).setRarity(z.UNCOMMON),new V("Rough Breakup",[new D0,new G("Reduce the power of cards in your hand by {formula}",[],($,J)=>{$.owner.cih().forEach((K)=>{K.setPow(K.pow()-$.card.pow())})}).setFormula("{pow}")]),new V("Mutual Cuckage",[new G("Increase everyone's cards to play to win by {formula}",[],($,J)=>{[$.owner,...$.opps].forEach((K)=>{K.addTurns(10+$.card.pow())})}).setFormula("10 + {pow}")]).setRarity(z.RARE),new V("Even the Playing Field",[new q0("Play only if you aren't the first player",($)=>{return $.owner.getTurnPlacement()>0}),new G("Decrease your cards to play to win by {formula}",[],($,J)=>{$.owner.addTurns(-(3+$.card.pow()))}).setFormula("3 + {pow}")]).setRarity(z.UNCOMMON),new V("Denial",[new G("Increase an opponent's cards to play to win by {formula}",[{choice:U.OPPONENT,pointer:T.OPPONENT_LEAST_TURNS_REMAINING}],($,J)=>{J[0].addTurns($.card.pow()*2)}).setFormula("{pow} * 2")]).setRarity(z.COMMON),new V("Get a Life",[new S(10,"life"),new k("life_deck",50,!0)]).setRarity(z.RARE),new V("Proletariat Revolution",[new q0("Play only if you're the first player",($)=>{return $.owner.getTurnPlacement()===0}),new G("Draw {formula} cards.",[],($,J)=>{if($.owner.getTurnPlacement()===0)$.owner.draw($.deck,$.card.pow()+2)}).setFormula("{pow} + 2")]).setRarity(z.COMMON),new V("Pile o' Crap",[new g0("\uD83D\uDCA9")]).setRarity(z.BASIC).setProp("crap",!0),new V("Beanz It",[new G('Add "Add {formula} turns to an opponent" to a card in your hand.',[{choice:U.CARD_IN_HAND,pointer:T.CARD_IN_HAND_RANDOM}],($,J)=>{let K=J[0];K.setName(`Bean-Fueled ${K.getName()} \uD83E\uDED8`),K.addAbility(new b0($.card.pow()-K.pow()))}).setFormula("{pow}")]).setRarity(z.COMMON),new V("Community Service Project",[new G('Add "Draw {formula} card" to a card in your hand.',[{choice:U.CARD_IN_HAND,pointer:T.CARD_IN_HAND_RANDOM}],($,J)=>{let K=J[0];K.setName(`Wizened ${K.getName()}`),K.addAbility(new m($.card?.pow()-K.pow()))}).setFormula("{pow}")]).setRarity(z.COMMON),new V("Academia",[new k("academia_deck",100,!0).setText("Invent student loans. Add academia to the game."),new G0]).setRarity(z.RARE),new V("Currency",[new k("currency_deck",100,!0,!0).setText("Invent currency. Add currency to the game."),new g(new E({name:"Get a Job",description:"Search for a job in Alaska.",cost:[{amt:3,resource:"turns"}],locked:!1},($)=>{$.owner.addUpgrade(new E({name:"Work",description:"Work for 50 Tadbucks.",cost:[{amt:1,resource:"turns"}]},(K)=>{K.owner.addResource("tadbucks",50)},!0,1.2))})).setText("You also invent the idea of working for pay."),new G0]).setRarity(z.RARE)]},$0=I$;class P0{name;cards=[];skipped=0;props={};events={};turnPlacement=0;turnsRemaining=20;canWin=!1;winReason="cards in hand";handSize=10;bot=!1;host=!1;botProfile=void 0;eventList={};constructor($,J){this.name=Math.random().toString(36).substring(7),this.draw(J,$),this.setProp("meta_upgrade",[]),this.addUpgrade(new E({name:"Meticulous Analysis",description:"Draw a card at the expense of slowing down.",cost:[{amt:1,resource:"turns"}],locked:!1},(K)=>{K.owner.draw(K.deck,1)},!0,1.5)),this.addEvent("draw",(K)=>{if(!K.card)return;if(!this.eventList[K.card.getName()])this.eventList[K.card.getName()]={drawn:0,played:0,discarded:0,given:0,text:""};this.eventList[K.card.getName()].drawn++,this.eventList[K.card.getName()].text=K.card.getText()}),this.addEvent("play",(K)=>{if(!this.eventList[K.card.getName()])this.eventList[K.card.getName()]={drawn:0,played:0,discarded:0,given:0,text:""};this.eventList[K.card.getName()].played++,this.eventList[K.card.getName()].text=K.card.getText(),K.owner.addTurns(-1)}),this.addEvent("discard",(K)=>{if(!K.card)return;if(!this.eventList[K.card.getName()])this.eventList[K.card.getName()]={drawn:0,played:0,discarded:0,given:0,text:""};this.eventList[K.card.getName()].discarded++,this.eventList[K.card.getName()].text=K.card.getText()}),this.addEvent("give",(K)=>{if(!this.eventList[K.card.getName()])this.eventList[K.card.getName()]={drawn:0,played:0,discarded:0,given:0,text:""};this.eventList[K.card.getName()].given++,this.eventList[K.card.getName()].text=K.card.getText()}),this.addEvent("res_life_change",(K)=>{if(this.getProp("res_life")<=0){if(!K.deck)return;if(!K.deck.props.added_zombie_deck)K.deck.addCards(d.fromCardList(45,$0.zombie_deck)),K.deck.shuffle(),K.deck.props.added_zombie_deck=!0}})}addResource($,J){if($.startsWith("res_"))$=$.substring(4);if(!this.getProp(`res_${$}`))this.setProp(`res_${$}`,0);this.setProp(`res_${$}`,this.getProp(`res_${$}`)+J)}upgrades(){return this.props.meta_upgrade||[]}addUpgrade($){if(!this.props.meta_upgrade)this.props.meta_upgrade=[];this.props.meta_upgrade.push($),this.fireEvents("new_upgrade",{owner:this,opps:[],deck:void 0,card:void 0})}setHost($=!0){return this.host=$,this}isHost(){return this.host}getResources(){let $={};for(let J in this.props)if(J.startsWith("res_"))$[J.substring(4)]=this.props[J];return $.turns=Infinity,$}getUIs(){return{marketplace:this.props.marketplace||!1,gene_bank:this.props.gene_bank||!1,casino:this.props.casino||!1,upgrade:!0}}getRelevantProps(){let $={};for(let J in this.props)if(!J.startsWith("meta_"))$[J]=this.props[J];return $}getPrivate($=!1){return{name:this.name,cards:this.cards.length,handsize:this.handSize,skipped:this.skipped,props:this.getRelevantProps(),turnsRemaining:this.turnsRemaining,canWin:this.canWin,winReason:this.winReason,host:this.host,you:$,order:this.turnPlacement}}getCards($,J){return this.cards.map((K)=>({name:K.getName(),text:K.getFormulatedText({owner:this,opps:$,deck:J,card:K}),rarity:K.getRarity(),power:K.pow(),formula:K.getFormulas(),props:K.getProps(),playable:K.canBePlayed({owner:this,opps:$,deck:J,card:K})}))}setBot(){return this.bot=!0,this.botProfile=new j0(Object.keys(e)[Math.floor(Math.random()*Object.keys(e).length)]),this}isBot(){return this.bot}setName($){return this.name=$,this}getCardStats(){return this.eventList}setTurnPlacement($){return this.turnPlacement=$,this}getTurnPlacement(){return this.turnPlacement}getHandsize(){return this.handSize}addHandsize($){return this.handSize+=$,this}setHandsize($){return this.handSize=$,this}propList(){return this.props}on($,J){return this.addEvent($,J),this}addEvent($,J){if(!this.events[$])this.events[$]=[];this.events[$].push(J)}getWinReason(){return this.winReason}fireEvents($,J){if(this.events[$])for(let K of this.events[$])K(J);if(this.events[`temp_${$}`]){for(let K of this.events[`temp_${$}`])K(J);delete this.events[`temp_${$}`]}}addTurns($){if(this.turnsRemaining+=$,this.turnsRemaining<=0)this.setCanWin(!0,"plodded across the finish line");return this}setTurns($){return this.turnsRemaining=$,this}getTurns(){return this.turnsRemaining}rollDice(){if(this.getProp("dice")){let $=this.getProp("dice");return $[Math.floor(Math.random()*$.length)]}return-1}setCanWin($,J="cards in hand"){if(this.canWin=$,this.winReason=J,this.canWin)this.fireEvents("can_win",{owner:this,opps:[],card:void 0,deck:void 0});return this}winCheck(){return this.canWin}setProp($,J,K){if(this.props[$]=J,K)this.fireEvents(`${$}_change`,K);return this}getProps(){return this.props}getProp($){return this.props[$]||0}skip(){this.skipped++}skipCheck(){if(this.skipped>0)return this.skipped--,!0;return!1}toPlayerState(){return{name:this.name,cards:this.cards.length,handsize:this.handSize,skipped:this.skipped,props:this.props,turnsRemaining:this.turnsRemaining,canWin:this.canWin,winReason:this.winReason,host:this.host,you:!1,order:this.turnPlacement}}getLogText(){return`\xA7\xA7${this.bot?`<b>[${this.botProfile.getProfileName()}]</b> `:""}${this.host?"<b>[HOST]</b> ":""}${this.name}\xA7player\xA7${JSON.stringify(this.toPlayerState())}\xA7\xA7`}getName(){return this.name}cih(){return this.cards}setCiH($){return this.cards=$,this}inHand(){return this.cards.length}turnStart($){for(let J of this.cards)J.fireEvents("turn_start",{...$,card:J})}draw($,J=1){let K=$.draw(J);for(let X of K)if(X.draw(this,[],$),this.fireEvents("draw",{owner:this,opps:[],deck:$,card:X}),J>=1)this.cards=this.cards.concat(X)}play($,J,K,X){if(this.cards.splice(this.cards.indexOf($),1),!$.doSkipDiscard())K.discardPile.push($);$.play(this,J,K,X),this.fireEvents("play",{owner:this,opps:J,deck:K,card:$})}give($,J){$.give(this,[J],void 0),this.fireEvents("give",{owner:this,opps:[],deck:void 0,card:$}),J.cards.push($),this.cards.splice(this.cards.indexOf($),1)}discard($,J){$.discard(this,[],J),this.fireEvents("discard",{owner:this,opps:[],deck:J,card:$}),J.discardPile.push($),this.cards.splice(this.cards.indexOf($),1)}discardRandom($){let J=this.cih()[Math.floor(Math.random()*this.cih().length)];if(J)this.discard(J,$.deck)}discardChoose($){let J=this.weightedDiscard($);if(J)this.discard(J,$.deck)}randomCard(){return this.cards[Math.floor(Math.random()*this.cards.length)]}weightedDiscard($){let J=Infinity,K=null;for(let X of this.cards)if(X&&this.botProfile){let Q=this.botProfile.evaluate(X,$);if(Q<J*(0.8+Math.random()*0.4))J=Q,K=X}return K}weightedDiscardToHand($){if(this.cih().length>this.getHandsize())while(this.cih().length>this.getHandsize()){let J=this.weightedDiscard($);if(J||!$.deck)this.discard(J,$.deck);else return}}weightedGive($){let J=Infinity,K=null;for(let X of this.cards)if(X&&this.botProfile){let Q=this.botProfile.evaluate(X,$);if(Q<J*(0.8+Math.random()*0.4))J=Q,K=X}return K}weightedPlay($){let J=(-Infinity),K=null;for(let X of this.cards)if(X&&this.botProfile){let Q=this.botProfile.evaluate(X,$);if(Q>J*(0.8+Math.random()*0.4)&&X.canBePlayed($))J=Q,K=X}return K}getEvent($){return this.events[$]}removeEvent($){return delete this.events[$],this}selectChoices($,J){return[]}evaluate($,J){return 0}}var R;(function(H){H[H["CONNECTED"]=0]="CONNECTED";H[H["DISCONNECTED"]=1]="DISCONNECTED";H[H["SET_NAME"]=2]="SET_NAME";H[H["UPDATE_PLAYER_STATE"]=3]="UPDATE_PLAYER_STATE";H[H["SERVER_MSG"]=4]="SERVER_MSG";H[H["ADD_BOT"]=5]="ADD_BOT";H[H["KICK_PLAYER"]=6]="KICK_PLAYER";H[H["TRANSFER_UPGRADE_SHOP"]=7]="TRANSFER_UPGRADE_SHOP";H[H["BUY_UPGRADE"]=8]="BUY_UPGRADE";H[H["TRANSFER_MARKETPLACE"]=9]="TRANSFER_MARKETPLACE";H[H["DRAW_CARD"]=10]="DRAW_CARD";H[H["PLAY_CARD"]=11]="PLAY_CARD";H[H["GIVE_CARD"]=12]="GIVE_CARD";H[H["DISCARD_TO_HAND"]=13]="DISCARD_TO_HAND";H[H["GET_CHOICES"]=14]="GET_CHOICES";H[H["CHOICE_LIST"]=15]="CHOICE_LIST";H[H["ERROR"]=16]="ERROR"})(R||(R={}));var k5=L0(B1(),1),p5=L0(V1(),1),A5=L0(Y1(),1),y5=L0(O1(),1),M1=L0(M$(),1);class R0{players={};sockets={};deck;turnPhase=0;activeTurn="";logEntries=[];sendableLogs=[];serverObj=void 0;serverPort=15912;serverConfig={startingHand:4,maxPlayers:6,minPlayers:1,fairness:!0};constructor(){this.deck=d.fromCardList(60,$0.basic),this.deck.shuffle(),console.log(this.deck.length)}reset(){if(this.serverObj)this.serverObj.close();this.deck=d.fromCardList(60,$0.basic),this.deck.shuffle(),this.sockets={},this.players={},this.turnPhase=0,this.activeTurn="",this.sendableLogs=[],this.log("Server reset!"),this.init(this.serverPort)}static createName(){return[["Cheddar","Swiss","Sewer","Moist","Crusty","Crunchy","Crispy","Bam","Bang","Slam","Meow","Bark","Grand","Del","Dip","Rich","Povert","Rogue","Joleto","Tad","Italian","Spicy","Salty","Sweet","Sour","Bitter","Stinky","Irritating","Meaty","Cool","Neato","Awesome","Sassy"],["amole","lotion","bacon","slice","sliver","fluid","ian","jess","tad","Loaf","Crust","Crunch","Crisp","Ioli","Head","Ino","Pants","Zilla","Shirt","Shoes","Hat","Glove","Sock","Spaghetti","Oritto","Ravioli","Gnocchi","Chilada","Pierogi","Burrito","Taco","Enchilada","Tamale","Changa","Dilla","Nachos","Tilla","Chip","Salsa","Guacamole","Asaurus","Eratops"],[" Mc"," "," "," "," "," "," "," "," Mac"," O'"],["Pan","Tad","Crap","Gene","Friendly","Spicy","Hate","Spinach","Slam","Magic","Eraser","Bougie","Ball","Supremo","Bean","Burger","Bread","Biscuit","Bacon","Bun","Biscuit","Burger","Bread","Kitty","Wood","Morning","Soft","Hard","Raging","",""],["Plumbing","Orama","Adic","Tastic","Full","Loaf","Fruit","Table","Chair","Brian","Brain","Atomy","Acist","Ologist","Doofus","Dorkus","Itis","Person","Biden","Trump","Obama","Bush","Clinton","Reagan","Carter","Folk","Ford","Sandal","Muncher","Potato","Whiskey","Bourbon"]].map((J,K)=>{let X=J[Math.floor(Math.random()*J.length)];if(K>0&&!X.startsWith(" "))X=X.toLowerCase();return X}).join("").split(" ").map((J)=>J[0].toUpperCase()+J.substring(1).toLowerCase()).join(" ")}log($){console.log($),this.logEntries.push($.toString())}gameLog($){this.sendableLogs.push($)}getDeck(){return this.deck}addPlayer(){if(this.serverConfig.fairness)Object.values(this.players).forEach((J)=>J.addTurns(1));let $=Math.random().toString(36).substring(7);if(this.players[$]=new P0(this.serverConfig.startingHand,this.deck).setTurnPlacement(Object.keys(this.players).length),this.players[$].addEvent("new_upgrade",(J)=>{this.updateUpgradeShop($)}),this.activeTurn==="")this.activeTurn=$,this.players[$].setHost();return{id:$,index:Object.keys(this.players).length-1}}addBot(){if(this.serverConfig.fairness)Object.values(this.players).forEach((J)=>J.addTurns(1));let $=Math.random().toString(36).substring(7);return this.players[$]=new P0(this.serverConfig.startingHand,this.deck).setTurnPlacement(Object.keys(this.players).length).setName(R0.createName()).setBot(),this.gameLog(`${this.players[$].getLogText()} joined the game as a bot.`),$}incrementPhase(){let $={owner:this.getActive(),opps:Object.values(this.players).filter((Q)=>Q!==this.getActive()),deck:this.deck},J=Object.keys(this.players).length>=2&&this.getActive().cih().length>=2&&this.getActive().cih().some((Q)=>Q.canBeGiven(this.getActive(),{...$,card:Q})),K=this.getActive().cih().some((Q)=>Q.canBePlayed({owner:this.getActive(),opps:Object.values(this.players).filter((Z)=>Z!==this.getActive()),deck:this.deck,card:Q}))||this.getActive().getProp("meta_upgrade").some((Q)=>{return Q.getData($)}),X=this.getActive().cih().length>this.getActive().getHandsize();if(this.turnPhase===0)if(J)this.turnPhase=1;else if(K)this.turnPhase=2;else if(X)this.turnPhase=3;else this.incrementTurn();else if(this.turnPhase===1)if(K)this.turnPhase=2;else if(X)this.turnPhase=3;else this.incrementTurn();else if(this.turnPhase===2)if(X)this.turnPhase=3;else this.incrementTurn();this.updateAllStates()}incrementTurn(){if(this.gameLog(`${this.getActive().getLogText()} ended their turn.`),this.gameLog("===NEW TURN==="),this.turnPhase=0,Object.values(this.players).length==0)this.activeTurn="",this.updateAllStates();else if(this.activeTurn=Object.keys(this.players)[(Object.keys(this.players).indexOf(this.activeTurn)+1)%Object.keys(this.players).length],this.gameLog(`${this.getActive().getLogText()} begins their turn.`),this.updateAllStates(),this.getActive().skipCheck())this.gameLog(`${this.getActive().getLogText()} is skipped.`),this.incrementTurn();else if(this.getActive().isBot())this.playBotTurn()}playBotTurn(){let $=Object.keys(this.players).filter((Q)=>Q!==this.activeTurn).map((Q)=>this.players[Q]),J={owner:this.getActive(),opps:$,deck:this.deck};this.getActive().draw(this.deck,1),this.gameLog(`${this.getActive().getLogText()} draws a card.`);let K=null;try{K=this.getActive().cih().filter((Q)=>Q.canBePlayed({...J,card:Q}))}catch(Q){this.gameLog(`${this.getActive().getLogText()} has an error in their hand: ${Q}`)}if(this.turnPhase=1,this.updateAllStates(),this.getActive().cih().length>=2){let Q=this.getActive().weightedGive(J);if(Q){let Z=$[Math.floor(Math.random()*$.length)];this.gameLog(`${this.getActive().getLogText()} gives ${Q.getLogText()} to ${Z.getLogText()}.`),this.getActive().give(Q,Z)}}else this.gameLog(`${this.getActive().getLogText()} doesn't have enough cards to be generous.`);let X=K.length>0;if(X)this.turnPhase=2;else this.turnPhase=3;if(this.updateAllStates(),X){let Q=this.getActive().weightedPlay(J);if(Q)this.gameLog(`${this.getActive().getLogText()} plays ${Q.getLogText()}.`),this.getActive().play(Q,$,this.deck);this.turnPhase=3,this.updateAllStates()}this.getActive().weightedDiscardToHand(J),this.incrementTurn()}updateUpgradeShop($){this.sockets[$].send(JSON.stringify({type:R.TRANSFER_UPGRADE_SHOP,shop:this.getActive().getProp("meta_upgrade").map((K)=>{return K.getData({owner:this.players[$],opps:[],deck:this.deck})})}))}disconnect($,J=""){for(let K of this.players[$].cih())this.deck.discardPile.push(K);if($===this.activeTurn)this.incrementTurn();if(this.log(`Player ${$} disconnected (${this.players[$].getLogText()}) - ${J}`),this.gameLog(`${this.players[$]} disconnected.`),this.sockets[$])this.sockets[$].send(JSON.stringify({type:R.SERVER_MSG,message:J})),this.sockets[$].send(JSON.stringify({type:R.DISCONNECTED}));if(delete this.players[$],delete this.sockets[$],this.serverConfig.fairness)Object.values(this.players).forEach((K)=>K.addTurns(-1));if(Object.keys(this.players).length>0){let K=Object.keys(this.players).find((X)=>!this.players[X].isBot());if(K)this.players[K].setHost(),this.gameLog(`${this.players[K]} is now the host.`);else this.log("No non-bots left, server entering reset mode"),this.reset()}if(Object.keys(this.players).length===0)this.activeTurn="",this.log("No non-bots left, server entering reset mode"),this.reset();this.updateAllStates()}getActive(){if(this.activeTurn==="")throw new Error("No active turn");return this.players[this.activeTurn]}sendState($){let J=Object.keys(this.players).filter((Q)=>Q!==$).map((Q)=>this.players[Q]),K=Object.keys(this.players).indexOf(this.activeTurn),X=Object.keys(this.players).indexOf($);if(this.players[$].isBot())return;this.sockets[$].send(JSON.stringify({type:R.UPDATE_PLAYER_STATE,state:{game:{players:Object.values(this.players).map((Q,Z)=>Q.getPrivate(Z===X)),turnPhase:this.turnPhase,uis:this.players[$].getUIs(),activeTurn:K,deck:this.deck.length,config:this.serverConfig,logs:this.sendableLogs.map((Q)=>Q.toString()),discard:this.deck.discardPile.map((Q)=>({name:Q.getName(),text:Q.getFormulatedText({owner:this.players[$],opps:J,deck:this.deck,card:Q}),rarity:Q.getRarity(),props:Q.getProps()}))},personal:this.players[$].getCards(J,this.deck)}}))}updateAllStates(){Object.keys(this.players).forEach(($)=>this.sendState($))}init($=15912){let J=this;J.log(`Server initialized on port ${$}`),this.serverPort=$,this.serverObj=new M1.default({port:$}),this.serverObj.on("connection",function K(X){X.on("message",function Z(Y){J.log(`Message received: ${Y}`);let _=JSON.parse(Y),j=_.id,F=Object.keys(J.players).filter((N)=>N!==j).map((N)=>J.players[N]);switch(_.type){case R.SET_NAME:if(_.name.length<1)_.name=R0.createName();J.players[j].setName(_.name),J.gameLog(`${J.players[j].getLogText()} joined the game`),J.updateAllStates();break;case R.DRAW_CARD:if(J.activeTurn==j&&J.turnPhase==0)J.players[j].draw(J.deck,1),J.gameLog(`${J.players[j].getLogText()} drew a card.`),J.incrementPhase();else if(J.activeTurn!==j)X.send(JSON.stringify({type:R.ERROR,message:"This card can't be played - not your turn."}));else X.send(JSON.stringify({type:R.ERROR,message:"This card can't be played - not the draw phase."}));J.updateAllStates();break;case R.GIVE_CARD:let N=_.idInHand,O=Object.keys(J.players)[_.target];if(J.activeTurn==j&&J.turnPhase==1&&O!==j&&J.players[j].cih().length>=2&&J.players[j].cih()[N].canBeGiven(J.players[O],{card:J.players[j].cih()[N],owner:J.players[j],opps:F,deck:J.deck}))J.gameLog(`${J.players[j].getLogText()} gives ${J.players[j].cih()[N].getLogText()} to ${J.players[O].getLogText()}.`),J.players[j].give(J.players[j].cih()[N],J.players[O]),J.incrementPhase();else if(J.activeTurn===j)X.send(JSON.stringify({type:R.ERROR,message:"This card can't be gifted - not your turn."}));else if(J.turnPhase!==1)X.send(JSON.stringify({type:R.ERROR,message:"This card can't be gifted - not the give phase."}));else if(J.players[j].cih().length<2)J.gameLog(`${J.players[j].getLogText()} doesn't have enough cards to be generous.`),J.incrementPhase();else X.send(JSON.stringify({type:R.ERROR,message:"This card can't be gifted - not giveable to this player."}));break;case R.GET_CHOICES:let P=_.idInHand,I=J.players[j].cih()[P];if(I.canBePlayed({owner:J.players[j],opps:F,deck:J.deck,card:I})&&J.activeTurn===j&&J.turnPhase==2){let C=JSON.stringify({type:R.CHOICE_LIST,card:P,splits:I.getAbilities().map((w)=>w.getChoices().length),choices:I.getChoices({owner:J.players[j],opps:F,deck:J.deck,card:I})});X.send(C)}else if(J.activeTurn===j)X.send(JSON.stringify({type:R.ERROR,message:"This card can't have choices selected - not your turn."}));else if(J.turnPhase!==2)X.send(JSON.stringify({type:R.ERROR,message:"This card can't be played - not the play phase."}));else X.send(JSON.stringify({type:R.ERROR,message:"This card can't be played"}));break;case R.PLAY_CARD:let B=_.idInHand,M=J.players[j].cih()[B],q=_.choices,H=q.map((C,w)=>{let b=M.orderAbilities()[w];return C.map((i,K1)=>{switch(b.informChoices({owner:J.players[j],opps:F,deck:J.deck,card:M})[K1].choice){case U.OPPONENT:case U.PLAYER:return J.players[Object.keys(J.players)[i]];case U.CARD_IN_HAND:return J.players[j].cih()[i];case U.CARD_IN_DISCARD:return J.deck.discardPile[i]}})});if(J.activeTurn===j&&J.turnPhase==2&&M.canBePlayed({owner:J.players[j],opps:F,deck:J.deck,card:M})){let C={owner:J.players[j],opps:F,deck:J.deck,card:M};if(M.getChoices(C).length>0)J.gameLog(`${J.players[j].getLogText()} plays ${M.getLogText()} with the following choices:\n${q.map((w,b)=>`${M.orderAbilities()[b].getFormulatedText(C)}: ${H[b].map((i)=>i.getLogText()).join(", ")}`).join("\n")}`);else J.gameLog(`${J.players[j].getLogText()} plays ${M.getLogText()}.`);J.players[j].play(M,F,J.deck,H),J.incrementPhase()}else if(J.activeTurn===j)X.send(JSON.stringify({type:R.ERROR,message:"This card can't be played - not your turn."}));else if(J.turnPhase!==2)X.send(JSON.stringify({type:R.ERROR,message:"This card can't be played - not the play phase."}));else X.send(JSON.stringify({type:R.ERROR,message:"This card can't be played - not playable."}));break;case R.DISCARD_TO_HAND:let _0=_.idInHand;if(J.activeTurn!==j)X.send(JSON.stringify({type:R.ERROR,message:"This card can't be discarded - not your turn."}));else if(J.turnPhase!==3)X.send(JSON.stringify({type:R.ERROR,message:"This card can't be discarded - not the discard phase."}));else if(J.players[j].cih().length<=J.players[j].getHandsize())X.send(JSON.stringify({type:R.ERROR,message:"This card can't be discarded - you don't have enough cards in hand."})),J.updateAllStates(),J.incrementTurn();else for(let C of _0)if(J.players[j].cih().length>=C+1){let w=[J.players[j].cih()[C]];J.players[j].setCiH(J.players[j].cih().filter((b)=>!w.includes(b)));for(let b of w)J.deck.discardPile.push(b);if(J.updateAllStates(),J.players[j].cih().length<=J.players[j].getHandsize())break}break;case R.ADD_BOT:if(J.players[j].isHost())J.addBot(),J.updateAllStates();else X.send(JSON.stringify({type:R.ERROR,message:"You can't add a bot - you aren't the host."}));break;case R.KICK_PLAYER:if(J.players[j].isHost()){let C=_.target,w=Object.keys(J.players)[C];if(w===j)X.send(JSON.stringify({type:R.ERROR,message:"You can't kick yourself."}));else J.gameLog(`${J.players[j]} kicked ${J.players[w]}.`),J.disconnect(w,_.message??"The host hated your guts.")}else X.send(JSON.stringify({type:R.ERROR,message:"You can't kick a player - you aren't the host."}));break;case R.TRANSFER_UPGRADE_SHOP:if(J.getActive().getUIs().upgrade)J.updateUpgradeShop(j);else X.send(JSON.stringify({type:R.ERROR,message:"You haven't unlocked the upgrade shop."}));break;case R.BUY_UPGRADE:let n=_.upgrade,p=J.getActive().getProp("meta_upgrade");if(J.activeTurn!==j)X.send(JSON.stringify({type:R.ERROR,message:"You can't buy an upgrade - not your turn."}));else if(!J.getActive().getUIs().upgrade)X.send(JSON.stringify({type:R.ERROR,message:"You can't buy an upgrade - you haven't unlocked the upgrade shop."}));else if(J.turnPhase!==2)X.send(JSON.stringify({type:R.ERROR,message:"You can't buy an upgrade - not the play phase."}));else if(p.length<=n||n<0||p[n].locked()||!p[n].canPayCost({owner:J.getActive(),opps:F,deck:J.deck}))X.send(JSON.stringify({type:R.ERROR,message:"You can't buy an upgrade - invalid upgrade."}));else p[n].unlock({owner:J.getActive(),opps:F,deck:J.deck}),J.gameLog(`${J.getActive().getLogText()} bought ${p[n].getData({owner:J.getActive(),opps:F,deck:J.deck}).name}.`),J.incrementPhase(),J.updateAllStates(),J.updateUpgradeShop(j);break}}),X.on("close",function Z(Y,_){let j=Object.keys(J.sockets).find((F)=>J.sockets[F]===X);J.disconnect(j)});let Q=J.addPlayer();J.sockets[Q.id]=X,X.send(JSON.stringify({type:R.CONNECTED,connected:Q.id,host:Object.keys(J.players)[0]==Q.id,turn:Q.index}))})}}var n5=new R0;n5.init(15192);
